<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuitBet AI - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #111827;
            color: #f9fafb;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: #1f2937;
            padding: 20px 24px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
            color: #22c55e;
        }
        
        .welcome-text {
            font-size: 16px;
            color: #f9fafb;
        }
        
        .nav {
            display: flex;
            justify-content: space-around;
            background: #1f2937;
            padding: 12px 8px;
            margin: 0;
            border-bottom: 1px solid #374151;
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
        }
        
        .nav-item {
            padding: 8px 4px;
            color: #9ca3af;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 12px;
            text-align: center;
            min-width: 60px;
            margin: 0 2px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .nav-item:hover {
            background: rgba(96, 165, 250, 0.1);
            color: #22c55e;
        }
        
        .nav-item.active {
            background: #22c55e;
            color: #000;
            box-shadow: 0 2px 8px rgba(96, 165, 250, 0.3);
        }
        
        .nav-icon {
            font-size: 16px;
        }
        
        .content {
            background: transparent;
            padding: 24px;
            margin: 0;
            min-height: calc(100vh - 200px);
        }
        
        .card {
            background: #1f2937;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid #374151;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .card h2 {
            color: #f9fafb;
            margin-bottom: 16px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card p {
            color: #d1d5db;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .days-card {
            background: #1f2937;
            border: 2px solid #34d399;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.2);
        }
        
        .days-number {
            font-size: 48px;
            font-weight: 700;
            color: #34d399;
            margin: 16px 0;
        }
        
        .days-text {
            color: #f9fafb;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .days-subtext {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .reset-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-button:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        .progress-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .progress-item {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #4b5563;
        }
        
        .progress-item h3 {
            color: #22c55e;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .progress-item p {
            color: #9ca3af;
            font-size: 14px;
            margin: 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #34d399);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 20%;
        }
        
        .finance-card {
            background: #1f2937;
            border: 2px solid #34d399;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.2);
        }
        
        .finance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }
        
        .finance-item {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #4b5563;
        }
        
        .finance-item h3 {
            color: #34d399;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .finance-item p {
            color: #9ca3af;
            font-size: 12px;
            margin: 0;
        }
        
        .button {
            background: #22c55e;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(96, 165, 250, 0.3);
            transition: all 0.2s ease;
        }
        
        .button:hover {
            background: #16a34a;
            transform: translateY(-1px);
        }
        
        
        .logout-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 24px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            transition: all 0.2s ease;
        }
        
        .logout-button:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }
        
        .textarea {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #4b5563;
            background: #374151;
            color: #f9fafb;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 12px;
        }
        
        .textarea:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }
        
        .chat-message {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            white-space: pre-line;
            line-height: 1.5;
        }
        
        .chat-message.user {
            background: #1f2937;
            border: 1px solid #22c55e;
            margin-left: 20px;
        }
        
        .chat-message.ai {
            background: #374151;
            border: 1px solid #34d399;
            margin-right: 20px;
        }
        
        .chat-sender {
            color: #22c55e;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .chat-sender.ai {
            color: #34d399;
        }
        
        .chat-content {
            color: #f9fafb;
            font-size: 14px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #374151;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-checkbox {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .task-label {
            color: #f9fafb;
            font-size: 14px;
        }
        
        .contact-card {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #4b5563;
        }
        
        .contact-card h4 {
            color: #f9fafb;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .contact-card p {
            color: #d1d5db;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .contact-button {
            background: #22c55e;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .crisis-card {
            background: #dc2626;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .crisis-card h2 {
            color: white;
            margin-bottom: 8px;
        }
        
        .crisis-card p {
            color: #fef2f2;
            margin-bottom: 16px;
        }
        
        .emergency-button {
            background: #1f2937;
            color: white;
            border: 2px solid #dc2626;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .emergency-button:hover {
            background: #374151;
            transform: translateY(-2px);
        }
        
        .grounding-steps {
            margin-bottom: 20px;
        }
        
        .grounding-step {
            background: #374151;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .grounding-step:hover {
            background: #4b5563;
            transform: translateX(4px);
        }
        
        .grounding-step.completed {
            background: #1f2937;
            border-color: #34d399;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.2);
        }
        
        .grounding-step.completed .step-check {
            opacity: 1;
            color: #34d399;
        }
        
        .step-number {
            color: #22c55e;
            font-weight: 700;
            font-size: 28px;
            margin-right: 16px;
            min-width: 40px;
            text-align: center;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-text {
            color: #f9fafb;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .step-description {
            color: #d1d5db;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .step-check {
            color: #34d399;
            font-size: 24px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .grounding-progress {
            margin-top: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #34d399);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            color: #9ca3af;
            font-size: 12px;
            text-align: center;
            margin: 0;
        }
        
        .breathing-container {
            text-align: center;
            padding: 20px 0;
        }
        
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #34d399, #10b981);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 4s ease-in-out;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(52, 211, 153, 0.3);
        }
        
        .breathing-circle.breathing-in {
            transform: scale(1.2);
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        
        .breathing-circle.breathing-out {
            transform: scale(0.8);
            background: linear-gradient(135deg, #34d399, #10b981);
        }
        
        .breathing-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }
        
        .breathing-instructions {
            margin: 20px 0;
            color: #d1d5db;
        }
        
        .breathing-instructions p {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(96, 165, 250, 0.3);
        }
        
        .breathing-circle.breathing-in {
            animation: breatheIn 4s ease-in-out infinite;
            background: linear-gradient(135deg, #34d399, #10b981);
        }
        
        .breathing-circle.breathing-out {
            animation: breatheOut 4s ease-in-out infinite;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }
        
        @keyframes breatheIn {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        @keyframes breatheOut {
            0% { transform: scale(1); }
            50% { transform: scale(0.7); }
            100% { transform: scale(1); }
        }
        
        .breathing-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        .breathing-instructions {
            margin-bottom: 20px;
        }
        
        .breathing-instructions p {
            color: #9ca3af;
            margin-bottom: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">QuitBet AI</h1>
            <p class="welcome-text">Welcome, <span id="userName">Friend</span>!</p>
        </div>
        
        <div class="nav">
            <div class="nav-item active" data-tab="dashboard">
                <div class="nav-icon">üìä</div>
                <div>Dashboard</div>
            </div>
            <div class="nav-item" data-tab="chat">
                <div class="nav-icon">üí¨</div>
                <div>Chat</div>
            </div>
            <div class="nav-item" data-tab="journal">
                <div class="nav-icon">üìñ</div>
                <div>Journal</div>
            </div>
            <div class="nav-item" data-tab="tasks">
                <div class="nav-icon">‚úÖ</div>
                <div>Tasks</div>
            </div>
            <div class="nav-item" data-tab="contacts">
                <div class="nav-icon">üë•</div>
                <div>Contacts</div>
            </div>
            <div class="nav-item" data-tab="finance">
                <div class="nav-icon">üí∞</div>
                <div>Finance</div>
            </div>
            <div class="nav-item" data-tab="grounding">
                <div class="nav-icon">üèîÔ∏è</div>
                <div>Grounding</div>
            </div>
            <div class="nav-item" data-tab="crisis">
                <div class="nav-icon">‚ö†Ô∏è</div>
                <div>Crisis</div>
            </div>
            <div class="nav-item" data-tab="sos">
                <div class="nav-icon">üÜò</div>
                <div>SOS</div>
            </div>
        </div>
        
        <div class="content" id="content">
            <!-- Days Gambling-Free Card -->
            <div class="days-card">
                <h2>Days Gambling-Free</h2>
                <div class="days-number" id="daysCount">0</div>
                <div class="days-text">Start your journey today!</div>
                <div class="days-subtext">Every day is a victory</div>
                <button class="reset-button" onclick="resetCounter()">Reset Counter</button>
            </div>
            
            <!-- Today's Goal Card -->
            <div class="card">
                <h2>Today's Goal</h2>
                <p>Stay focused on your recovery journey. Take it one day at a time.</p>
                <button class="button" onclick="setTodaysGoal()">Set Goal</button>
            </div>
            
            <!-- Progress This Week Card -->
            <div class="card">
                <h2>Progress This Week</h2>
                <p>Tasks completed: <span id="tasksCompleted">0</span></p>
                <p>Journal entries: <span id="journalEntries">0</span></p>
                <p>Grounding exercises: <span id="groundingExercises">0</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="weeklyProgress"></div>
                </div>
                <p>Great start! Keep building momentum.</p>
            </div>
            
            <!-- Financial Recovery Card -->
            <div class="finance-card">
                <h2>üí∞ Financial Recovery</h2>
                <div class="finance-grid">
                    <div class="finance-item">
                        <h3 id="moneySaved">$0.00</h3>
                        <p>Money Saved</p>
                    </div>
                    <div class="finance-item">
                        <h3 id="netSavings">$0.00</h3>
                        <p>Net Savings</p>
                    </div>
                    <div class="finance-item">
                        <h3 id="dailyAvg">$0.00</h3>
                        <p>Daily Avg</p>
                    </div>
                </div>
                <button class="button" onclick="showTab('finance', event)">View Full Finance Report</button>
            </div>
        </div>
        
        
        <div style="padding: 24px;">
            <button class="logout-button" onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = '/';
        }
        
        // Set user name
        const userName = localStorage.getItem('userName') || 'Friend';
        document.getElementById('userName').textContent = userName;
        
        // Get user-specific storage key
        const userEmail = localStorage.getItem('userEmail') || 'default';
        const userStorageKey = `userData_${userEmail.replace('@', '_').replace('.', '_')}`;
        
        // Function to get user-specific data
        function getUserData(key, defaultValue = null) {
            const userData = JSON.parse(localStorage.getItem(userStorageKey) || '{}');
            return userData[key] !== undefined ? userData[key] : defaultValue;
        }
        
        // Function to set user-specific data
        function setUserData(key, value) {
            const userData = JSON.parse(localStorage.getItem(userStorageKey) || '{}');
            userData[key] = value;
            localStorage.setItem(userStorageKey, JSON.stringify(userData));
        }
        
        // Load saved data
        loadDashboardData();
        
        // Add event listeners for navigation
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.nav-item[data-tab]');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    showTab(tab);
                });
            });
        });
        
        // Restore current tab if available
        const currentTab = localStorage.getItem('currentTab') || 'dashboard';
        showTab(currentTab);
        
        function loadDashboardData() {
            // Load days gambling-free
            updateGamblingFreeCounter();
            
            // Load tasks completed
            const tasksCompleted = getUserData('tasksCompleted', '0');
            document.getElementById('tasksCompleted').textContent = tasksCompleted;
            
            // Load journal entries
            const journalEntries = getUserData('journalEntries', []).length;
            document.getElementById('journalEntries').textContent = journalEntries;
            
            // Load grounding exercises
            const groundingExercises = getUserData('groundingExercises', '0');
            document.getElementById('groundingExercises').textContent = groundingExercises;
            
            // Start the day checking timer
            startDayCheckTimer();
            
            // Load financial data
            const expenses = getUserData('expenses', []);
            const expenseItems = expenses.filter(item => item.type === 'expense');
            const savingsItems = expenses.filter(item => item.type === 'savings');
            
            const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
            const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
            const netAmount = totalSavings - totalExpenses;
            
            document.getElementById('moneySaved').textContent = '$' + totalSavings.toFixed(2);
            document.getElementById('netSavings').textContent = '$' + netAmount.toFixed(2);
            document.getElementById('dailyAvg').textContent = '$' + (totalSavings / 7).toFixed(2);
            
            // Update weekly progress
            const weeklyProgress = Math.min((parseInt(tasksCompleted) + journalEntries + parseInt(groundingExercises)) / 21 * 100, 100);
            document.getElementById('weeklyProgress').style.width = weeklyProgress + '%';
        }
        
        function showTab(tab) {
            console.log('Switching to tab:', tab);
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to the correct nav item
            const activeItem = document.querySelector(`[data-tab="${tab}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Store current tab for reference
            localStorage.setItem('currentTab', tab);
            
            // Update content based on tab
            const content = document.getElementById('content');
            switch(tab) {
                case 'dashboard':
                    content.innerHTML = `
                        <div class="days-card">
                            <h2>Days Gambling-Free</h2>
                            <div class="days-number" id="daysCount">0</div>
                            <div class="days-text">Start your journey today!</div>
                            <div class="days-subtext">Every day is a victory</div>
                            <button class="reset-button" onclick="resetCounter()">Reset Counter</button>
                        </div>
                        
                        <div class="card">
                            <h2>Today's Goal</h2>
                            <p>Stay focused on your recovery journey. Take it one day at a time.</p>
                            <button class="button" onclick="setTodaysGoal()">Set Goal</button>
                        </div>
                        
                        <div class="card">
                            <h2>Progress This Week</h2>
                            <p>Tasks completed: <span id="tasksCompleted">0</span></p>
                            <p>Journal entries: <span id="journalEntries">0</span></p>
                            <p>Grounding exercises: <span id="groundingExercises">0</span></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="weeklyProgress"></div>
                            </div>
                            <p>Great start! Keep building momentum.</p>
                        </div>
                        
                        <div class="finance-card">
                            <h2>üí∞ Financial Recovery</h2>
                            <div class="finance-grid">
                                <div class="finance-item">
                                    <h3 id="moneySaved">$0.00</h3>
                                    <p>Money Saved</p>
                                </div>
                                <div class="finance-item">
                                    <h3 id="netSavings">$0.00</h3>
                                    <p>Net Savings</p>
                                </div>
                                <div class="finance-item">
                                    <h3 id="dailyAvg">$0.00</h3>
                                    <p>Daily Avg</p>
                                </div>
                            </div>
                            <button class="button" onclick="showFinanceReport()">View Full Finance Report</button>
                        </div>
                    `;
                    loadDashboardData();
                    break;
                case 'chat':
                    content.innerHTML = `
                        <div class="card">
                            <h2>AI Chat</h2>
                            <p>Chat with our AI assistant for support and guidance.</p>
                            
                            <div id="chatMessages" style="height: 300px; overflow-y: auto; background: #374151; border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid #4b5563;">
                                <div class="chat-message ai">
                                    <div class="chat-sender ai">AI:</div>
                                    <div class="chat-content">Hello! I'm here to support you on your recovery journey. How are you feeling today?</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="chatInput" placeholder="Type your message..." style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #4b5563; background: #374151; color: #f9fafb; font-size: 14px;" onkeypress="handleChatKeyPress(event)">
                                <button class="button" onclick="sendMessage()" style="margin: 0;">Send</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'journal':
                    content.innerHTML = `
                        <div class="card">
                            <h2>Journal</h2>
                            <p>Record your thoughts and feelings.</p>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="color: #9ca3af; font-size: 14px; margin-bottom: 8px; display: block;">How are you feeling today?</label>
                                <select id="moodSelect" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #4b5563; background: #374151; color: #f9fafb; font-size: 14px; margin-bottom: 16px;">
                                    <option value="great">üòä Great</option>
                                    <option value="good">üôÇ Good</option>
                                    <option value="okay">üòê Okay</option>
                                    <option value="struggling">üòî Struggling</option>
                                    <option value="difficult">üò∞ Difficult</option>
                                </select>
                            </div>
                            
                            <textarea class="textarea" placeholder="Write about your day, your feelings, or your recovery journey..." rows="6"></textarea>
                            
                            <div style="display: flex; gap: 12px; margin-top: 16px;">
                                <button class="button" onclick="saveJournal()" style="flex: 1;">Save Entry</button>
                                <button class="button" onclick="viewJournalEntries()" style="flex: 1; background: #6b7280;">View Entries</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'tasks':
                    // Load saved tasks
                    const savedTasks = getUserData('savedTasks', []);
                    
                    let tasksHtml = `
                        <div class="card">
                            <h2>Tasks</h2>
                            <p>Complete daily tasks to build healthy habits.</p>
                            
                            <h3 style="color: #22c55e; margin: 16px 0 12px 0;">Daily Habits</h3>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task1" onchange="updateTask(1)">
                                <label class="task-label" for="task1">Take a 10-minute walk</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task2" onchange="updateTask(2)">
                                <label class="task-label" for="task2">Practice deep breathing for 5 minutes</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task3" onchange="updateTask(3)">
                                <label class="task-label" for="task3">Call a friend or family member</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task4" onchange="updateTask(4)">
                                <label class="task-label" for="task4">Write in your journal</label>
                            </div>
                    `;
                    
                    // Add saved tasks (including goals)
                    if (savedTasks.length > 0) {
                        tasksHtml += `<h3 style="color: #34d399; margin: 20px 0 12px 0;">Your Goals & Tasks</h3>`;
                        savedTasks.forEach(task => {
                            const isGoal = task.type === 'goal';
                            const icon = isGoal ? 'üéØ' : '‚úÖ';
                            tasksHtml += `
                                <div class="task-item">
                                    <input type="checkbox" class="task-checkbox" id="savedTask${task.id}" onchange="updateSavedTask(${task.id})">
                                    <label class="task-label" for="savedTask${task.id}">${icon} ${task.text}</label>
                                    <button onclick="deleteTask(${task.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">Delete</button>
                                </div>
                            `;
                        });
                    }
                    
                    tasksHtml += `<button class="button" onclick="addCustomTask()" style="margin-top: 16px;">Add Custom Task</button></div>`;
                    
                    content.innerHTML = tasksHtml;
                    loadTasks();
                    break;
                case 'finance':
                    // Calculate financial data
                    const expenses = getUserData('expenses', []);
                    const expenseItems = expenses.filter(item => item.type === 'expense');
                    const savingsItems = expenses.filter(item => item.type === 'savings');
                    
                    const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
                    const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
                    const netAmount = totalSavings - totalExpenses;
                    
                    const todayExpenses = expenseItems.filter(expense => expense.date === new Date().toLocaleDateString());
                    const todayTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
                    
                    const monthlyGoal = 500;
                    const progress = Math.min((totalSavings / monthlyGoal) * 100, 100);
                    
                    // Determine colors based on whether expenses exceed savings
                    const amountColor = netAmount < 0 ? '#dc2626' : '#22c55e';
                    const todayColor = todayTotal > 0 ? '#dc2626' : '#22c55e';
                    
                    content.innerHTML = `
                        <div class="card">
                            <h2>Finance</h2>
                            <p>Track your financial recovery.</p>
                            
                            <div class="progress-grid">
                                <div class="progress-item">
                                    <h3 style="color: ${todayColor}">$${todayTotal.toFixed(2)}</h3>
                                    <p>Spent today</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: ${amountColor}">$${netAmount.toFixed(2)}</h3>
                                    <p>Net amount</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: #34d399">$${totalSavings.toFixed(2)}</h3>
                                    <p>Total saved</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: #22c55e">${progress.toFixed(0)}%</h3>
                                    <p>Goal progress</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h3 style="color: #22c55e; margin-bottom: 12px;">Recent Transactions</h3>
                                ${expenses.length > 0 ? expenses.slice(0, 5).map(expense => {
                                    const isExpense = expense.type === 'expense';
                                    const color = isExpense ? '#dc2626' : '#34d399';
                                    const icon = isExpense ? 'üìâ' : 'üìà';
                                    const prefix = isExpense ? '-' : '+';
                                    return `
                                        <div style="background: #374151; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <span style="color: ${color}; font-weight: 600;">${icon} ${prefix}$${expense.amount.toFixed(2)}</span>
                                                <span style="color: #9ca3af; font-size: 12px; margin-left: 8px;">${expense.date}</span>
                                                <span style="color: #9ca3af; font-size: 12px; margin-left: 4px;">(${expense.type})</span>
                                            </div>
                                            <button onclick="deleteExpense(${expense.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Delete</button>
                                        </div>
                                    `;
                                }).join('') : '<p style="color: #9ca3af;">No transactions yet</p>'}
                            </div>
                            
                            <div style="display: flex; gap: 12px; margin-top: 16px;">
                                <button class="button" onclick="addExpense()" style="flex: 1;">Add Expense</button>
                                <button class="button" onclick="addSavings()" style="flex: 1; background: #34d399;">Add Savings</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'grounding':
                    content.innerHTML = `
                        <div class="card">
                            <h2>üßò Grounding Exercise</h2>
                            <p>If you're feeling overwhelmed, try this 5-4-3-2-1 technique:</p>
                            
                            <div class="grounding-steps">
                                <div class="grounding-step" onclick="toggleGroundingStep(0)">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <div class="step-text">things you can see</div>
                                        <div class="step-description">Look around and name 5 things you can see</div>
                                    </div>
                                    <div class="step-check">‚úì</div>
                                </div>
                                
                                <div class="grounding-step" onclick="toggleGroundingStep(1)">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <div class="step-text">things you can touch</div>
                                        <div class="step-description">Name 4 things you can feel with your hands</div>
                                    </div>
                                    <div class="step-check">‚úì</div>
                                </div>
                                
                                <div class="grounding-step" onclick="toggleGroundingStep(2)">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <div class="step-text">things you can hear</div>
                                        <div class="step-description">Listen and identify 3 sounds around you</div>
                                    </div>
                                    <div class="step-check">‚úì</div>
                                </div>
                                
                                <div class="grounding-step" onclick="toggleGroundingStep(3)">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <div class="step-text">things you can smell</div>
                                        <div class="step-description">Take a deep breath and notice 2 scents</div>
                                    </div>
                                    <div class="step-check">‚úì</div>
                                </div>
                                
                                <div class="grounding-step" onclick="toggleGroundingStep(4)">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <div class="step-text">thing you can taste</div>
                                        <div class="step-description">Focus on 1 taste in your mouth</div>
                                    </div>
                                    <div class="step-check">‚úì</div>
                                </div>
                            </div>
                            
                            <div class="grounding-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="groundingProgress"></div>
                                </div>
                                <p class="progress-text">Complete each step by tapping on it</p>
                            </div>
                        </div>
                    `;
                    loadGroundingProgress();
                    break;
                case 'crisis':
                    content.innerHTML = `
                        <div class="crisis-card">
                            <h2>üö® Crisis Support</h2>
                            <p>You are not alone. Help is available right now.</p>
                            <button class="emergency-button" onclick="callEmergency()">Call Emergency Services (911)</button>
                            <button class="emergency-button" onclick="callSuicidePrevention()" style="background: #22c55e; border-color: #22c55e;">Call Suicide Prevention (988)</button>
                            <button class="emergency-button" onclick="textCrisis()" style="background: #34d399; border-color: #34d399;">Text HOME to 741741</button>
                        </div>
                        
                        <div class="card">
                            <h2>ü´Å Breathing Exercise</h2>
                            <p>Take a moment to center yourself with guided breathing.</p>
                            
                            <div class="breathing-container">
                                <div class="breathing-circle" id="breathingCircle">
                                    <div class="breathing-text" id="breathingText">Tap to Start</div>
                                </div>
                                <div class="breathing-instructions" id="breathingInstructions">
                                    <p>Follow the circle as it expands and contracts</p>
                                    <p>Breathe in as it grows, breathe out as it shrinks</p>
                                </div>
                                <button class="button" onclick="startBreathingExercise()" id="breathingButton">Start Breathing Exercise</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2>üíô Remember</h2>
                            <p>‚Ä¢ You are not alone in this moment</p>
                            <p>‚Ä¢ These feelings are temporary</p>
                            <p>‚Ä¢ You are worthy of help and support</p>
                            <p>‚Ä¢ There are people who care about you</p>
                            <p>‚Ä¢ This crisis will pass</p>
                        </div>
                    `;
                    break;
                case 'sos':
                    content.innerHTML = `
                        <div class="crisis-card">
                            <h2>üÜò Emergency Gambling Support</h2>
                            <p>Free, confidential help available 24/7. You are not alone.</p>
                        </div>
                        
                        <div class="card">
                            <h2>üìû National Gambling Helplines</h2>
                            <p>Free, confidential support available 24/7</p>
                            
                            <div class="contact-card">
                                <h4>üá∫üá∏ National Problem Gambling Helpline</h4>
                                <p>üìû Phone: 1-800-522-4700</p>
                                <p>üåê Website: ncpgambling.org</p>
                                <p>üí¨ Text: 1-800-522-4700</p>
                                <button class="contact-button" onclick="callHelpline('1-800-522-4700', 'National Problem Gambling Helpline')">Call Now</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üá∫üá∏ Gamblers Anonymous</h4>
                                <p>üìû Phone: 1-626-960-3500</p>
                                <p>üåê Website: gamblersanonymous.org</p>
                                <p>üìç Find meetings near you</p>
                                <button class="contact-button" onclick="callHelpline('1-626-960-3500', 'Gamblers Anonymous')">Call Now</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üá∫üá∏ SAMHSA National Helpline</h4>
                                <p>üìû Phone: 1-800-662-4357</p>
                                <p>üåê Website: samhsa.gov</p>
                                <p>üí¨ Text: 435748 (HELP4U)</p>
                                <button class="contact-button" onclick="callHelpline('1-800-662-4357', 'SAMHSA National Helpline')">Call Now</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üá∫üá∏ Crisis Text Line</h4>
                                <p>üí¨ Text: HOME to 741741</p>
                                <p>üåê Website: crisistextline.org</p>
                                <p>üí¨ Available 24/7 via text</p>
                                <button class="contact-button" onclick="textCrisis()">Text Now</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2>üåç International Helplines</h2>
                            <p>Support available worldwide</p>
                            
                            <div class="contact-card">
                                <h4>üá®üá¶ Problem Gambling Institute of Ontario</h4>
                                <p>üìû Phone: 1-888-230-3505</p>
                                <p>üåê Website: problemgambling.ca</p>
                                <button class="contact-button" onclick="callHelpline('1-888-230-3505', 'Problem Gambling Institute of Ontario')">Call Now</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üá¨üáß GamCare (UK)</h4>
                                <p>üìû Phone: 0808 8020 133</p>
                                <p>üåê Website: gamcare.org.uk</p>
                                <p>üí¨ Live chat available</p>
                                <button class="contact-button" onclick="callHelpline('0808-8020-133', 'GamCare UK')">Call Now</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üá¶üá∫ Gambling Help Online (Australia)</h4>
                                <p>üìû Phone: 1800 858 858</p>
                                <p>üåê Website: gamblinghelponline.org.au</p>
                                <p>üí¨ Live chat available</p>
                                <button class="contact-button" onclick="callHelpline('1800-858-858', 'Gambling Help Online Australia')">Call Now</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2>üë• Your Personal Support</h2>
                            <p>Your saved contacts and support network</p>
                            
                            <div class="contact-card">
                                <h4>üè• Dr. Sarah Johnson - Therapist</h4>
                                <p>üìû Phone: (555) 123-4567</p>
                                <p>üìß Email: sarah.johnson@therapy.com</p>
                                <button class="contact-button" onclick="callContact('therapist')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üë®‚Äç‚öïÔ∏è Mike Chen - Counselor</h4>
                                <p>üìû Phone: (555) 987-6543</p>
                                <p>üìß Email: mike.chen@recovery.org</p>
                                <button class="contact-button" onclick="callContact('counselor')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Mom & Dad</h4>
                                <p>üìû Phone: (555) 456-7890</p>
                                <button class="contact-button" onclick="callContact('family')">Call</button>
                            </div>
                            
                            <button class="button" onclick="addContact()" style="margin-top: 16px;">Add Personal Contact</button>
                        </div>
                    `;
                    break;
                case 'contacts':
                    // Load saved contacts
                    const savedContacts = getUserData('contacts', []);
                    
                    let contactsHtml = `
                        <div class="card">
                            <h2>Support Contacts</h2>
                            <p>Your personal support network and professional contacts.</p>
                            
                            <h3 style="color: #22c55e; margin: 20px 0 12px 0;">Professional Support</h3>
                            <div class="contact-card">
                                <h4>üè• Dr. Sarah Johnson - Therapist</h4>
                                <p>üìû Phone: (555) 123-4567</p>
                                <p>üìß Email: sarah.johnson@therapy.com</p>
                                <button class="contact-button" onclick="callContact('therapist')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üë®‚Äç‚öïÔ∏è Mike Chen - Counselor</h4>
                                <p>üìû Phone: (555) 987-6543</p>
                                <p>üìß Email: mike.chen@recovery.org</p>
                                <button class="contact-button" onclick="callContact('counselor')">Call</button>
                            </div>
                            
                            <h3 style="color: #22c55e; margin: 20px 0 12px 0;">Personal Support</h3>
                            <div class="contact-card">
                                <h4>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Mom & Dad</h4>
                                <p>üìû Phone: (555) 456-7890</p>
                                <button class="contact-button" onclick="callContact('family')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>üë• Gamblers Anonymous</h4>
                                <p>üìû Phone: (555) 321-0987</p>
                                <p>üìç Meeting: Tuesdays 7 PM</p>
                                <button class="contact-button" onclick="callContact('support-group')">Call</button>
                            </div>
                    `;
                    
                    // Add saved contacts
                    if (savedContacts.length > 0) {
                        contactsHtml += `<h3 style="color: #22c55e; margin: 20px 0 12px 0;">Your Contacts</h3>`;
                        savedContacts.forEach(contact => {
                            contactsHtml += `
                                <div class="contact-card">
                                    <h4>üë§ ${contact.name}</h4>
                                    <p>üìû Phone: ${contact.phone}</p>
                                    <button class="contact-button" onclick="callSavedContact('${contact.name}', '${contact.phone}')">Call</button>
                                    <button class="contact-button" onclick="deleteContact(${contact.id})" style="background: #dc2626; margin-left: 8px;">Delete</button>
                                </div>
                            `;
                        });
                    }
                    
                    contactsHtml += `<button class="button" onclick="addContact()">Add New Contact</button></div>`;
                    
                    content.innerHTML = contactsHtml;
                    break;
            }
        }
        
        function resetCounter() {
            resetGamblingCounter();
        }
        
        function setTodaysGoal() {
            const goal = prompt('What is your goal for today?');
            if (goal) {
                localStorage.setItem('todaysGoal', goal);
                
                // Add the goal as a task
                const newTask = {
                    id: Date.now(),
                    text: goal,
                    completed: false,
                    type: 'goal',
                    date: new Date().toLocaleDateString()
                };
                
                let tasks = getUserData('savedTasks', []);
                tasks.unshift(newTask);
                setUserData('savedTasks', tasks);
                
                alert('Goal set and added to your tasks! You can do this!');
            }
        }
        
        function updateTask(taskNumber) {
            const tasksCompleted = parseInt(getUserData('tasksCompleted', '0') || '0');
            setUserData('tasksCompleted', (parseInt(tasksCompleted) + 1).toString());
            loadDashboardData();
        }
        
        function loadTasks() {
            // Load saved task states
            const savedTasks = getUserData('savedTasks', []);
            savedTasks.forEach(task => {
                const checkbox = document.getElementById(`task${task.id}`);
                if (checkbox) {
                    checkbox.checked = task.completed;
                }
            });
        }
        
        function showFinanceReport() {
            // Switch to finance tab directly
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to finance nav item
            const financeNavItem = document.querySelector('.nav-item[onclick*="finance"]');
            if (financeNavItem) {
                financeNavItem.classList.add('active');
            }
            
            // Update content directly to finance tab
            const content = document.getElementById('content');
            
            // Calculate financial data
            const expenses = getUserData('expenses', []);
            const expenseItems = expenses.filter(item => item.type === 'expense');
            const savingsItems = expenses.filter(item => item.type === 'savings');
            
            const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
            const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
            const netAmount = totalSavings - totalExpenses;
            
            const todayExpenses = expenseItems.filter(expense => expense.date === new Date().toLocaleDateString());
            const todayTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            const monthlyGoal = 500;
            const progress = Math.min((totalSavings / monthlyGoal) * 100, 100);
            
            // Determine colors based on whether expenses exceed savings
            const amountColor = netAmount < 0 ? '#dc2626' : '#22c55e';
            const todayColor = todayTotal > 0 ? '#dc2626' : '#22c55e';
            
            content.innerHTML = `
                <div class="card">
                    <h2>Finance</h2>
                    <p>Track your financial recovery.</p>
                    
                    <div class="progress-grid">
                        <div class="progress-item">
                            <h3 style="color: ${todayColor}">$${todayTotal.toFixed(2)}</h3>
                            <p>Spent today</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: ${amountColor}">$${netAmount.toFixed(2)}</h3>
                            <p>Net amount</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: #34d399">$${totalSavings.toFixed(2)}</h3>
                            <p>Total saved</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: #22c55e">${progress.toFixed(0)}%</h3>
                            <p>Goal progress</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="color: #22c55e; margin-bottom: 12px;">Recent Transactions</h3>
                        ${expenses.length > 0 ? expenses.slice(0, 5).map(expense => {
                            const isExpense = expense.type === 'expense';
                            const color = isExpense ? '#dc2626' : '#34d399';
                            const icon = isExpense ? 'üìâ' : 'üìà';
                            const prefix = isExpense ? '-' : '+';
                            return `
                                <div style="background: #374151; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="color: ${color}; font-weight: 600;">${icon} ${prefix}$${expense.amount.toFixed(2)}</span>
                                        <span style="color: #9ca3af; font-size: 12px; margin-left: 8px;">${expense.date}</span>
                                        <span style="color: #9ca3af; font-size: 12px; margin-left: 4px;">(${expense.type})</span>
                                    </div>
                                    <button onclick="deleteExpense(${expense.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Delete</button>
                                </div>
                            `;
                        }).join('') : '<p style="color: #9ca3af;">No transactions yet</p>'}
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button class="button" onclick="addExpense()" style="flex: 1;">Add Expense</button>
                        <button class="button" onclick="addSavings()" style="flex: 1; background: #34d399;">Add Savings</button>
                    </div>
                </div>
            `;
        }
        
        function updateSavedTask(taskId) {
            const checkbox = document.getElementById(`savedTask${taskId}`);
            const tasks = getUserData('savedTasks', []);
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.completed = checkbox.checked;
                setUserData('savedTasks', tasks);
                
                if (checkbox.checked) {
                    const tasksCompleted = parseInt(getUserData('tasksCompleted', '0') || '0');
                    setUserData('tasksCompleted', (parseInt(tasksCompleted) + 1).toString());
                    loadDashboardData();
                }
            }
        }
        
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                let tasks = getUserData('savedTasks', []);
                tasks = tasks.filter(task => task.id !== taskId);
                setUserData('savedTasks', tasks);
                showTab('tasks'); // Refresh the tasks view
            }
        }
        
        function addCustomTask() {
            const taskText = prompt('Enter your custom task:');
            if (taskText) {
                const newTask = {
                    id: Date.now(),
                    text: taskText,
                    completed: false,
                    type: 'custom',
                    date: new Date().toLocaleDateString()
                };
                
                let tasks = getUserData('savedTasks', []);
                tasks.unshift(newTask);
                setUserData('savedTasks', tasks);
                
                alert('Custom task added!');
                showTab('tasks'); // Refresh the tasks view
            }
        }
        
        function toggleGroundingStep(stepIndex) {
            const step = document.querySelectorAll('.grounding-step')[stepIndex];
            const progressFill = document.getElementById('groundingProgress');
            
            if (step.classList.contains('completed')) {
                step.classList.remove('completed');
            } else {
                step.classList.add('completed');
            }
            
            // Update progress
            const completedSteps = document.querySelectorAll('.grounding-step.completed').length;
            const totalSteps = 5;
            const progressPercentage = (completedSteps / totalSteps) * 100;
            progressFill.style.width = progressPercentage + '%';
            
            // Save progress to localStorage
            localStorage.setItem('groundingProgress', completedSteps.toString());
            
            // Show completion message
            if (completedSteps === totalSteps) {
                setTimeout(() => {
                    alert('üéâ Congratulations! You\'ve completed the grounding exercise. Take a moment to notice how you feel now.');
                    // Increment total grounding exercises completed
                    const groundingExercises = parseInt(getUserData('groundingExercises', '0') || '0');
                    setUserData('groundingExercises', (parseInt(groundingExercises) + 1).toString());
                    loadDashboardData();
                }, 500);
            }
        }
        
        function loadGroundingProgress() {
            const completedSteps = parseInt(localStorage.getItem('groundingProgress') || '0');
            const progressFill = document.getElementById('groundingProgress');
            
            if (progressFill) {
                const progressPercentage = (completedSteps / 5) * 100;
                progressFill.style.width = progressPercentage + '%';
                
                // Mark completed steps
                for (let i = 0; i < completedSteps; i++) {
                    const step = document.querySelectorAll('.grounding-step')[i];
                    if (step) {
                        step.classList.add('completed');
                    }
                }
            }
        }
        
        function completeGroundingExercise() {
            const groundingExercises = parseInt(getUserData('groundingExercises', '0') || '0');
            setUserData('groundingExercises', (parseInt(groundingExercises) + 1).toString());
            alert('Great job! You completed the grounding exercise. Take a moment to notice how you feel.');
            loadDashboardData();
        }
        
        function logout() {
            // Only remove the session flag, keep user account information
            localStorage.removeItem('isLoggedIn');
            alert('Logged out successfully! You can sign back in anytime.');
            window.location.href = '/';
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) {
                return;
            }
            
            // Add user message to chat
            addMessageToChat('You', message, '#22c55e');
            input.value = '';
            
            // Show typing indicator
            const typingId = addTypingIndicator();
            
            try {
                // Get API URL from environment or use default
                const apiUrl = localStorage.getItem('apiUrl') || 'https://endbet-ai-api.vercel.app';
                
                // Send message to OpenAI via our API
                const response = await fetch(`${apiUrl}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        userId: localStorage.getItem('userId') || 'user123',
                        context: 'gambling_recovery'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to get AI response');
                }
                
                const data = await response.json();
                
                // Remove typing indicator
                removeTypingIndicator(typingId);
                
                // Add AI response to chat
                addMessageToChat('AI', data.message || data.response, '#34d399');
                
            } catch (error) {
                console.error('Error getting AI response:', error);
                
                // Remove typing indicator
                removeTypingIndicator(typingId);
                
                // Fallback to local responses
                const fallbackResponse = getFallbackResponse(message);
                addMessageToChat('AI', fallbackResponse, '#34d399');
            }
        }
        
        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            const typingId = 'typing-' + Date.now();
            typingDiv.id = typingId;
            typingDiv.className = 'chat-message ai';
            typingDiv.innerHTML = `
                <div class="chat-sender ai">AI:</div>
                <div class="chat-content">Typing...</div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingId;
        }
        
        function removeTypingIndicator(typingId) {
            const typingDiv = document.getElementById(typingId);
            if (typingDiv) {
                typingDiv.remove();
            }
        }
        
        function getFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('encouragement') || lowerMessage.includes('compliment') || lowerMessage.includes('motivation')) {
                return "üåü You are incredibly brave for taking this journey towards recovery! Every single day you choose not to gamble is a victory worth celebrating. You have the strength within you to overcome this challenge, and I believe in your ability to build a healthier, happier life. You're not alone in this - you have support, you have resources, and most importantly, you have the determination to succeed. Keep going, one day at a time. You've got this! üí™\n\nRemember: Recovery isn't about being perfect, it's about making progress. Every small step counts!";
            } else if (lowerMessage.includes('step') || lowerMessage.includes('plan') || lowerMessage.includes('help') || lowerMessage.includes('how')) {
                return "Here's a comprehensive step-by-step plan to help you stop gambling:\n\nüéØ **Phase 1: Preparation (Days 1-7)**\n1. **Acknowledge the problem** - You've already done this by reaching out!\n2. **Set a quit date** - Choose a specific date to stop completely\n3. **Remove triggers** - Delete gambling apps, block gambling sites\n4. **Tell someone** - Share your decision with a trusted person\n\nüõ°Ô∏è **Phase 2: Action (Days 8-30)**\n5. **Find alternatives** - Replace gambling with healthy activities\n6. **Build support** - Connect with friends, family, or support groups\n7. **Track progress** - Use this app to monitor your recovery\n8. **Celebrate milestones** - Reward yourself for each day gambling-free\n\nüí™ **Phase 3: Maintenance (30+ days)**\n9. **Identify triggers** - Learn what makes you want to gamble\n10. **Develop coping skills** - Practice healthy ways to handle stress\n11. **Stay connected** - Keep your support system strong\n12. **Help others** - Share your experience to help someone else\n\nWould you like me to help you with any specific step?";
            } else if (lowerMessage.includes('urge') || lowerMessage.includes('craving') || lowerMessage.includes('want to gamble') || lowerMessage.includes('tempted')) {
                return "üö® **URGE SURVIVAL KIT** - When you feel the urge to gamble:\n\n‚ö° **Immediate actions (0-5 minutes):**\n‚Ä¢ Take 10 deep breaths - breathe in for 4, hold for 4, out for 4\n‚Ä¢ Call a support person immediately\n‚Ä¢ Go for a 5-minute walk\n‚Ä¢ Do something with your hands (draw, write, clean)\n‚Ä¢ Use the grounding exercise in this app\n\nüí™ **Medium-term strategies (5-30 minutes):**\n‚Ä¢ Identify what triggered this urge\n‚Ä¢ Practice mindfulness or meditation\n‚Ä¢ Keep busy with a hobby\n‚Ä¢ Remember why you're quitting\n‚Ä¢ Look at your progress in this app\n\nüèÜ **Long-term prevention:**\n‚Ä¢ Avoid places where you used to gamble\n‚Ä¢ Change your routine\n‚Ä¢ Find new ways to handle stress\n‚Ä¢ Celebrate every urge you overcome\n\n**Remember:** Urges are temporary! They will pass. You've overcome them before, and you can do it again. The urge will get weaker each time you resist it.";
            } else if (lowerMessage.includes('relapse') || lowerMessage.includes('slipped') || lowerMessage.includes('gambled') || lowerMessage.includes('failed')) {
                return "üíö **It's okay - relapses are part of recovery.** Don't be too hard on yourself.\n\n**What to do RIGHT NOW:**\n1. **Stop immediately** - Don't chase losses or try to win back money\n2. **Remove yourself** - Leave the gambling location immediately\n3. **Call someone** - Reach out to your support person\n4. **Learn from this** - What triggered it? What can you do differently?\n5. **Get back on track** - Start fresh today, not tomorrow\n\n**Remember:** Every day is a new chance to start fresh. You're still making progress! Relapse doesn't erase all your hard work. You've learned something valuable from this experience.\n\n**Your next steps:**\n‚Ä¢ Use the SOS section in this app for immediate support\n‚Ä¢ Update your recovery plan based on what you learned\n‚Ä¢ Be extra kind to yourself today\n‚Ä¢ Remember: You're human, and recovery is a journey, not a destination.";
            } else if (lowerMessage.includes('money') || lowerMessage.includes('debt') || lowerMessage.includes('financial') || lowerMessage.includes('broke')) {
                return "üí∞ **Financial Recovery Plan** - Let's get your money back on track:\n\nüö® **Immediate actions (Today):**\n‚Ä¢ Stop all gambling immediately - no exceptions\n‚Ä¢ Create a basic budget - income vs. expenses\n‚Ä¢ Cut unnecessary expenses (subscriptions, dining out)\n‚Ä¢ Consider debt consolidation or payment plans\n‚Ä¢ Use the Finance tab in this app to track everything\n\nüìä **Short-term goals (1-3 months):**\n‚Ä¢ Build a $500 emergency fund\n‚Ä¢ Pay minimums on all debts\n‚Ä¢ Track every dollar saved by not gambling\n‚Ä¢ Set up automatic savings\n‚Ä¢ Celebrate every financial milestone\n\nüí° **Long-term vision (6+ months):**\n‚Ä¢ Pay off high-interest debt first\n‚Ä¢ Build 3-6 months of expenses in savings\n‚Ä¢ Consider professional financial counseling\n‚Ä¢ Plan for your future goals\n\n**Remember:** Every dollar not gambled is money saved! You're not just stopping gambling - you're building wealth. Use the Finance tab to see your progress daily.";
            } else if (lowerMessage.includes('family') || lowerMessage.includes('relationship') || lowerMessage.includes('support') || lowerMessage.includes('alone')) {
                return "ü§ù **Building Your Support System** - You don't have to do this alone:\n\nüë®‚Äçüë©‚Äçüëß‚Äçüë¶ **Family & Friends:**\n‚Ä¢ Be honest about your struggles - they want to help\n‚Ä¢ Ask for their support in specific ways\n‚Ä¢ Let them know how they can help (check-ins, activities, etc.)\n‚Ä¢ Consider family therapy if relationships are strained\n‚Ä¢ Remember: They love you and want you to succeed\n\nüè• **Professional Support:**\n‚Ä¢ Therapists specializing in gambling addiction\n‚Ä¢ Support groups (Gamblers Anonymous, SMART Recovery)\n‚Ä¢ Financial counselors for debt management\n‚Ä¢ This AI assistant (me!) - available 24/7\n‚Ä¢ Crisis helplines in the SOS section\n\nüí™ **Self-Support:**\n‚Ä¢ Use this app daily to track progress\n‚Ä¢ Practice self-compassion\n‚Ä¢ Celebrate small wins\n‚Ä¢ Learn about addiction and recovery\n‚Ä¢ Develop new hobbies and interests\n\n**Remember:** Asking for help is a sign of strength, not weakness. You deserve support and you're worth the effort it takes to recover.";
            } else if (lowerMessage.includes('stress') || lowerMessage.includes('anxiety') || lowerMessage.includes('overwhelmed')) {
                return "üßò **Stress Management for Recovery** - Let's handle this together:\n\n‚ö° **Quick stress relief (0-5 minutes):**\n‚Ä¢ Use the grounding exercise in this app\n‚Ä¢ Take 10 deep breaths\n‚Ä¢ Go for a short walk\n‚Ä¢ Listen to calming music\n‚Ä¢ Call someone for support\n\nüí™ **Daily stress management:**\n‚Ä¢ Practice mindfulness or meditation\n‚Ä¢ Exercise regularly (even just walking)\n‚Ä¢ Get enough sleep (7-9 hours)\n‚Ä¢ Eat regular, healthy meals\n‚Ä¢ Limit caffeine and alcohol\n\nüéØ **Long-term stress reduction:**\n‚Ä¢ Identify your stress triggers\n‚Ä¢ Develop healthy coping strategies\n‚Ä¢ Build a strong support system\n‚Ä¢ Consider therapy or counseling\n‚Ä¢ Practice self-care regularly\n\n**Remember:** Stress is a common trigger for gambling. By managing stress better, you're protecting your recovery. You've got this!";
            } else {
                const responses = [
                    "I'm here to support you on your recovery journey. What specific challenge are you facing today? I'm ready to help with practical advice, encouragement, or just listening.",
                    "It's great that you're reaching out for help. How can I best support you right now? Whether it's dealing with urges, financial stress, or just needing encouragement, I'm here.",
                    "I understand this is difficult. What would be most helpful for you to hear right now? I can provide specific strategies, emotional support, or help you work through any challenge.",
                    "You're taking important steps by seeking support. What's on your mind? I'm here to help with whatever you're going through in your recovery journey.",
                    "I'm proud of you for reaching out. What's been the most challenging part of your day?",
                    "Remember, recovery is a journey with ups and downs. How are you feeling right now?",
                    "You're stronger than you think. What support do you need today?",
                    "Every small step counts in recovery. What would help you feel more supported?"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }
        
        function addMessageToChat(sender, message, color) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender.toLowerCase()}`;
            
            const senderDiv = document.createElement('div');
            senderDiv.className = `chat-sender ${sender.toLowerCase()}`;
            senderDiv.textContent = sender + ':';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-content';
            contentDiv.textContent = message;
            
            messageDiv.appendChild(senderDiv);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function saveJournal() {
            const textarea = document.querySelector('.textarea');
            const moodSelect = document.getElementById('moodSelect');
            const entry = textarea.value.trim();
            const mood = moodSelect ? moodSelect.value : 'okay';
            
            if (!entry) {
                alert('Please write something before saving.');
                return;
            }
            
            // Save to localStorage for demo
            const journalEntry = {
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                mood: mood,
                content: entry
            };
            
            let entries = getUserData('journalEntries', []);
            entries.unshift(journalEntry);
            setUserData('journalEntries', entries);
            
            alert('Journal entry saved successfully! Keep reflecting on your journey.');
            textarea.value = '';
            loadDashboardData();
        }
        
        function viewJournalEntries() {
            const entries = getUserData('journalEntries', []);
            
            if (entries.length === 0) {
                alert('No journal entries yet. Start writing to track your journey!');
                return;
            }
            
            let entriesHtml = '<div class="card"><h2>Your Journal Entries</h2>';
            entries.forEach((entry, index) => {
                const moodEmoji = {
                    'great': 'üòä',
                    'good': 'üôÇ',
                    'okay': 'üòê',
                    'struggling': 'üòî',
                    'difficult': 'üò∞'
                }[entry.mood] || 'üòê';
                
                entriesHtml += `
                    <div style="background: #374151; padding: 16px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #4b5563;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: #22c55e; font-weight: 600;">${moodEmoji} ${entry.mood.charAt(0).toUpperCase() + entry.mood.slice(1)}</span>
                            <span style="color: #9ca3af; font-size: 12px;">${entry.date} ${entry.time}</span>
                        </div>
                        <p style="color: #f9fafb; margin: 0; line-height: 1.5;">${entry.content}</p>
                    </div>
                `;
            });
            entriesHtml += '</div>';
            
            document.getElementById('content').innerHTML = entriesHtml;
        }
        
        function addExpense() {
            const amount = prompt('Enter expense amount:');
            if (amount && !isNaN(amount)) {
                // Save expense to localStorage
                const expense = {
                    id: Date.now(),
                    amount: parseFloat(amount),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    type: 'expense'
                };
                
                let expenses = getUserData('expenses', []);
                expenses.unshift(expense);
                setUserData('expenses', expenses);
                
                alert(`Expense of $${amount} added successfully!`);
                loadDashboardData();
                
                // Refresh finance tab if it's currently active
                const activeTab = document.querySelector('.nav-item.active');
                if (activeTab && activeTab.textContent.includes('Finance')) {
                    showTab('finance');
                }
            } else {
                alert('Please enter a valid amount.');
            }
        }
        
        function addSavings() {
            const amount = prompt('Enter savings amount:');
            if (amount && !isNaN(amount)) {
                // Save savings to localStorage
                const saving = {
                    id: Date.now(),
                    amount: parseFloat(amount),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    type: 'savings'
                };
                
                let expenses = getUserData('expenses', []);
                expenses.unshift(saving);
                setUserData('expenses', expenses);
                
                alert(`Savings of $${amount} added successfully!`);
                loadDashboardData();
                
                // Refresh finance tab if it's currently active
                const activeTab = document.querySelector('.nav-item.active');
                if (activeTab && activeTab.textContent.includes('Finance')) {
                    showTab('finance');
                }
            } else {
                alert('Please enter a valid amount.');
            }
        }
        
        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                let expenses = getUserData('expenses', []);
                expenses = expenses.filter(expense => expense.id !== expenseId);
                setUserData('expenses', expenses);
                alert('Expense deleted successfully!');
                showTab('finance');
            }
        }
        
        function callEmergency() {
            if (confirm('Are you sure you want to call emergency services? This will dial 911.')) {
                makePhoneCall('911', 'Emergency Services');
            }
        }
        
        function callSuicidePrevention() {
            if (confirm('Call Suicide Prevention Lifeline (988)?')) {
                makePhoneCall('988', 'Suicide Prevention Lifeline');
            }
        }
        
        function textCrisis() {
            if (confirm('Text HOME to 741741 for crisis support?')) {
                // Open SMS app with crisis text line
                if (navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)) {
                    // Mobile device - use sms: protocol
                    window.location.href = 'sms:741741&body=HOME';
                } else {
                    // Desktop - copy to clipboard
                    navigator.clipboard.writeText('HOME').then(() => {
                        alert('Text "HOME" copied to clipboard! Send it to 741741 for crisis support.');
                    }).catch(() => {
                        prompt('Text this message to 741741:', 'HOME');
                    });
                }
            }
        }
        
        function startBreathingExercise() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const button = document.getElementById('breathingButton');
            const instructions = document.getElementById('breathingInstructions');
            
            if (button.textContent === 'Start Breathing Exercise') {
                button.textContent = 'Stop Exercise';
                instructions.innerHTML = '<p>Breathe in as the circle expands</p><p>Breathe out as the circle contracts</p>';
                
                let cycleCount = 0;
                const maxCycles = 5;
                let isRunning = true;
                
                // Start the breathing cycle
                function breathingCycle() {
                    if (!isRunning || cycleCount >= maxCycles) {
                        if (cycleCount >= maxCycles) {
                            circle.className = 'breathing-circle';
                            text.textContent = 'Exercise Complete!';
                            button.textContent = 'Start Breathing Exercise';
                            instructions.innerHTML = '<p>Great job! You\'ve completed the breathing exercise.</p><p>Take a moment to notice how you feel.</p>';
                        }
                        return;
                    }
                    
                    // Breathe in phase
                    circle.className = 'breathing-circle breathing-in';
                    text.textContent = 'Breathe In';
                    
                    setTimeout(() => {
                        if (!isRunning) return;
                        
                        // Breathe out phase
                        circle.className = 'breathing-circle breathing-out';
                        text.textContent = 'Breathe Out';
                        
                        setTimeout(() => {
                            if (!isRunning) return;
                            
                            cycleCount++;
                            if (cycleCount < maxCycles) {
                                // Brief pause between cycles
                                circle.className = 'breathing-circle';
                                text.textContent = 'Pause';
                                
                                setTimeout(() => {
                                    if (isRunning) {
                                        breathingCycle();
                                    }
                                }, 1000);
                            } else {
                                // Exercise complete
                                circle.className = 'breathing-circle';
                                text.textContent = 'Exercise Complete!';
                                button.textContent = 'Start Breathing Exercise';
                                instructions.innerHTML = '<p>Great job! You\'ve completed the breathing exercise.</p><p>Take a moment to notice how you feel.</p>';
                            }
                        }, 4000); // 4 seconds for breathing out
                    }, 4000); // 4 seconds for breathing in
                }
                
                // Store running state for stopping
                circle.dataset.isRunning = 'true';
                breathingCycle();
                
            } else {
                // Stop the exercise
                circle.dataset.isRunning = 'false';
                circle.className = 'breathing-circle';
                text.textContent = 'Tap to Start';
                button.textContent = 'Start Breathing Exercise';
                instructions.innerHTML = '<p>Follow the circle as it expands and contracts</p><p>Breathe in as it grows, breathe out as it shrinks</p>';
            }
        }
        
        function callContact(contactType) {
            const contacts = {
                'therapist': { name: 'Dr. Sarah Johnson', phone: '555-123-4567' },
                'counselor': { name: 'Mike Chen', phone: '555-987-6543' },
                'family': { name: 'Mom & Dad', phone: '555-456-7890' },
                'support-group': { name: 'Gamblers Anonymous', phone: '555-321-0987' }
            };
            
            const contact = contacts[contactType];
            if (contact && confirm(`Call ${contact.name} at ${contact.phone}?`)) {
                makePhoneCall(contact.phone, contact.name);
            }
        }
        
        function makePhoneCall(phoneNumber, contactName) {
            // Clean the phone number (remove any non-digit characters except +)
            const cleanNumber = phoneNumber.replace(/[^\d+]/g, '');
            
            // Check if we're on a mobile device or if the device supports calling
            if (navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)) {
                // Mobile device - use tel: protocol
                window.location.href = `tel:${cleanNumber}`;
            } else {
                // Desktop or other device - show options
                const callOptions = `
                    Choose how to call ${contactName}:
                    
                    1. Copy number: ${cleanNumber}
                    2. Open calling app
                    3. Use video calling
                    
                    Click OK to copy the number to clipboard.
                `;
                
                if (confirm(callOptions)) {
                    // Copy to clipboard
                    navigator.clipboard.writeText(cleanNumber).then(() => {
                        alert(`Phone number ${cleanNumber} copied to clipboard! You can now paste it into your calling app.`);
                    }).catch(() => {
                        // Fallback if clipboard API fails
                        prompt('Copy this phone number:', cleanNumber);
                    });
                }
            }
        }
        
        function callHelpline(phoneNumber, helplineName) {
            if (confirm(`Call ${helplineName} at ${phoneNumber}?\n\nThis is a free, confidential gambling support helpline available 24/7.`)) {
                makePhoneCall(phoneNumber, helplineName);
            }
        }
        
        function textCrisis() {
            if (confirm('Text HOME to 741741 for Crisis Text Line?\n\nThis will open your messaging app with the number pre-filled.')) {
                // Open messaging app with the crisis text line number
                if (navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)) {
                    window.location.href = 'sms:741741&body=HOME';
                } else {
                    // Desktop fallback
                    navigator.clipboard.writeText('741741').then(() => {
                        alert('Crisis Text Line number 741741 copied to clipboard!\n\nText "HOME" to this number for immediate support.');
                    }).catch(() => {
                        prompt('Text this number: 741741\n\nSend "HOME" to this number for immediate support.', '741741');
                    });
                }
            }
        }
        
        function openSOS() {
            // Show immediate crisis support options
            const crisisOptions = `
                üö® EMERGENCY SUPPORT OPTIONS üö®
                
                Choose your preferred support method:
                
                1. üìû Call National Gambling Helpline: 1-800-522-4700
                2. üí¨ Text Crisis Text Line: HOME to 741741
                3. üåê Open full SOS section with all resources
                4. üì± Call your personal contacts
                
                Click OK to open the full SOS section with all resources.
            `;
            
            if (confirm(crisisOptions)) {
                showTab('sos');
            } else {
                // Quick access to most important helplines
                const quickHelp = confirm('Call National Gambling Helpline (1-800-522-4700) now?');
                if (quickHelp) {
                    callHelpline('1-800-522-4700', 'National Problem Gambling Helpline');
                }
            }
        }
        
        function addContact() {
            const name = prompt('Enter contact name:');
            if (name) {
                const phone = prompt('Enter phone number:');
                if (phone) {
                    // Save contact to localStorage
                    const contact = {
                        id: Date.now(),
                        name: name,
                        phone: phone,
                        type: 'personal'
                    };
                    
                    let contacts = getUserData('contacts', []);
                    contacts.push(contact);
                    setUserData('contacts', contacts);
                    
                    alert(`Contact "${name}" with phone "${phone}" added successfully!`);
                    // Refresh contacts view
                    showTab('contacts');
                } else {
                    alert('Contact not added - phone number required.');
                }
            } else {
                alert('Contact not added - name required.');
            }
        }
        
        function callSavedContact(name, phone) {
            if (confirm(`Call ${name} at ${phone}?`)) {
                makePhoneCall(phone, name);
            }
        }
        
        function updateGamblingFreeCounter() {
            const startDate = localStorage.getItem('gamblingFreeStartDate');
            const lastCheckedDate = localStorage.getItem('lastCheckedDate');
            const today = new Date().toDateString();
            
            // If no start date is set, set it to today
            if (!startDate) {
                localStorage.setItem('gamblingFreeStartDate', today);
                localStorage.setItem('lastCheckedDate', today);
                document.getElementById('daysCount').textContent = '0';
                return;
            }
            
            // If it's a new day, update the counter
            if (lastCheckedDate !== today) {
                const start = new Date(startDate);
                const current = new Date();
                const timeDiff = current.getTime() - start.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                // Update the counter
                document.getElementById('daysCount').textContent = daysDiff;
                localStorage.setItem('lastCheckedDate', today);
                localStorage.setItem('daysGamblingFree', daysDiff.toString());
                
                // Show celebration for milestones
                if (daysDiff > 0 && daysDiff % 7 === 0) {
                    showMilestoneCelebration(daysDiff);
                }
            } else {
                // Just display the current count
                const daysCount = localStorage.getItem('daysGamblingFree') || '0';
                document.getElementById('daysCount').textContent = daysCount;
            }
        }
        
        function startDayCheckTimer() {
            // Check for new day every 5 minutes
            setInterval(() => {
                updateGamblingFreeCounter();
            }, 5 * 60 * 1000); // 5 minutes
        }
        
        function showMilestoneCelebration(days) {
            const messages = {
                7: "üéâ Congratulations! You've been gambling-free for 1 week!",
                14: "üåü Amazing! 2 weeks gambling-free! You're building great habits!",
                30: "üèÜ Incredible! 1 month gambling-free! You're doing fantastic!",
                60: "üí™ Outstanding! 2 months gambling-free! You're unstoppable!",
                90: "üéä Phenomenal! 3 months gambling-free! You're a true champion!",
                180: "üåü Spectacular! 6 months gambling-free! You're an inspiration!",
                365: "üèÜ LEGENDARY! 1 year gambling-free! You've completely transformed your life!"
            };
            
            if (messages[days]) {
                setTimeout(() => {
                    alert(messages[days] + "\n\nKeep up the amazing work! üíö");
                }, 1000);
            }
        }
        
        function resetGamblingCounter() {
            if (confirm('Are you sure you want to reset your gambling-free counter? This will start counting from today.')) {
                const today = new Date().toDateString();
                localStorage.setItem('gamblingFreeStartDate', today);
                localStorage.setItem('lastCheckedDate', today);
                localStorage.setItem('daysGamblingFree', '0');
                updateGamblingFreeCounter();
                alert('Gambling-free counter reset. Starting fresh from today!');
            }
        }
        
        // Breathing exercise variables
        let breathingInterval = null;
        let isBreathing = false;
        let breathingPhase = 'in'; // 'in' or 'out'
        
        function startBreathingExercise() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const button = document.getElementById('breathingButton');
            
            if (!isBreathing) {
                // Start breathing exercise
                isBreathing = true;
                button.textContent = 'Stop Exercise';
                button.style.background = '#dc2626';
                
                // Start the breathing cycle
                breathingCycle();
                
                // Set up interval for continuous breathing
                breathingInterval = setInterval(breathingCycle, 8000); // 8 seconds per cycle (4 in, 4 out)
            } else {
                // Stop breathing exercise
                stopBreathingExercise();
            }
        }
        
        function stopBreathingExercise() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const button = document.getElementById('breathingButton');
            
            // Clear the interval
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
            
            // Reset state
            isBreathing = false;
            breathingPhase = 'in';
            
            // Reset UI
            circle.className = 'breathing-circle';
            text.textContent = 'Tap to Start';
            button.textContent = 'Start Breathing Exercise';
            button.style.background = '#16a34a';
        }
        
        function breathingCycle() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            
            if (breathingPhase === 'in') {
                // Breathing in phase
                circle.className = 'breathing-circle breathing-in';
                text.textContent = 'Breathe In';
                breathingPhase = 'out';
            } else {
                // Breathing out phase
                circle.className = 'breathing-circle breathing-out';
                text.textContent = 'Breathe Out';
                breathingPhase = 'in';
            }
        }
        
        function deleteContact(contactId) {
            if (confirm('Are you sure you want to delete this contact?')) {
                let contacts = getUserData('contacts', []);
                contacts = contacts.filter(contact => contact.id !== contactId);
                setUserData('contacts', contacts);
                alert('Contact deleted successfully!');
                showTab('contacts');
            }
        }
    </script>
</body>
</html>