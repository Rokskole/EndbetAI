<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuitBet AI - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #111827;
            color: #f9fafb;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: #1f2937;
            padding: 20px 24px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
            color: #60a5fa;
        }
        
        .welcome-text {
            font-size: 16px;
            color: #f9fafb;
        }
        
        .nav {
            display: flex;
            justify-content: space-around;
            background: #1f2937;
            padding: 12px 8px;
            margin: 0;
            border-bottom: 1px solid #374151;
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
        }
        
        .nav-item {
            padding: 8px 4px;
            color: #9ca3af;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 12px;
            text-align: center;
            min-width: 60px;
            margin: 0 2px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .nav-item:hover {
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
        }
        
        .nav-item.active {
            background: #60a5fa;
            color: #000;
            box-shadow: 0 2px 8px rgba(96, 165, 250, 0.3);
        }
        
        .nav-icon {
            font-size: 16px;
        }
        
        .content {
            background: transparent;
            padding: 24px;
            margin: 0;
            min-height: calc(100vh - 200px);
        }
        
        .card {
            background: #1f2937;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid #374151;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .card h2 {
            color: #f9fafb;
            margin-bottom: 16px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card p {
            color: #d1d5db;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .days-card {
            background: #1f2937;
            border: 2px solid #34d399;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.2);
        }
        
        .days-number {
            font-size: 48px;
            font-weight: 700;
            color: #34d399;
            margin: 16px 0;
        }
        
        .days-text {
            color: #f9fafb;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .days-subtext {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .reset-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-button:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        .progress-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .progress-item {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #4b5563;
        }
        
        .progress-item h3 {
            color: #60a5fa;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .progress-item p {
            color: #9ca3af;
            font-size: 14px;
            margin: 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #60a5fa, #34d399);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 20%;
        }
        
        .finance-card {
            background: #1f2937;
            border: 2px solid #34d399;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.2);
        }
        
        .finance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }
        
        .finance-item {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #4b5563;
        }
        
        .finance-item h3 {
            color: #34d399;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .finance-item p {
            color: #9ca3af;
            font-size: 12px;
            margin: 0;
        }
        
        .button {
            background: #60a5fa;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(96, 165, 250, 0.3);
            transition: all 0.2s ease;
        }
        
        .button:hover {
            background: #3b82f6;
            transform: translateY(-1px);
        }
        
        .fab-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fab:hover {
            transform: scale(1.05);
        }
        
        .fab.crisis {
            background: #60a5fa;
        }
        
        .fab.sos {
            background: #dc2626;
        }
        
        .logout-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 24px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            transition: all 0.2s ease;
        }
        
        .logout-button:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }
        
        .textarea {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #4b5563;
            background: #374151;
            color: #f9fafb;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 12px;
        }
        
        .textarea:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }
        
        .chat-message {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            white-space: pre-line;
            line-height: 1.5;
        }
        
        .chat-message.user {
            background: #1f2937;
            border: 1px solid #60a5fa;
            margin-left: 20px;
        }
        
        .chat-message.ai {
            background: #374151;
            border: 1px solid #34d399;
            margin-right: 20px;
        }
        
        .chat-sender {
            color: #60a5fa;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .chat-sender.ai {
            color: #34d399;
        }
        
        .chat-content {
            color: #f9fafb;
            font-size: 14px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #374151;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-checkbox {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .task-label {
            color: #f9fafb;
            font-size: 14px;
        }
        
        .contact-card {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #4b5563;
        }
        
        .contact-card h4 {
            color: #f9fafb;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .contact-card p {
            color: #d1d5db;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .contact-button {
            background: #60a5fa;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .crisis-card {
            background: #dc2626;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .crisis-card h2 {
            color: white;
            margin-bottom: 8px;
        }
        
        .crisis-card p {
            color: #fef2f2;
            margin-bottom: 16px;
        }
        
        .emergency-button {
            background: #1f2937;
            color: white;
            border: 2px solid #dc2626;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .emergency-button:hover {
            background: #374151;
            transform: translateY(-2px);
        }
        
        .grounding-step {
            background: #374151;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
        }
        
        .step-number {
            color: #60a5fa;
            font-weight: 700;
            font-size: 24px;
            margin-right: 16px;
            min-width: 30px;
        }
        
        .step-text {
            color: #f9fafb;
            font-size: 14px;
            line-height: 1.5;
            flex: 1;
        }
        
        .breathing-container {
            text-align: center;
            padding: 20px 0;
        }
        
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(96, 165, 250, 0.3);
        }
        
        .breathing-circle.breathing-in {
            animation: breatheIn 4s ease-in-out infinite;
            background: linear-gradient(135deg, #34d399, #10b981);
        }
        
        .breathing-circle.breathing-out {
            animation: breatheOut 4s ease-in-out infinite;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }
        
        @keyframes breatheIn {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        @keyframes breatheOut {
            0% { transform: scale(1); }
            50% { transform: scale(0.7); }
            100% { transform: scale(1); }
        }
        
        .breathing-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        .breathing-instructions {
            margin-bottom: 20px;
        }
        
        .breathing-instructions p {
            color: #9ca3af;
            margin-bottom: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">QuitBet AI</h1>
            <p class="welcome-text">Welcome, <span id="userName">Friend</span>!</p>
        </div>
        
        <div class="nav">
            <div class="nav-item active" onclick="showTab('dashboard')">
                <div class="nav-icon">📊</div>
                <div>Dashboard</div>
            </div>
            <div class="nav-item" onclick="showTab('chat')">
                <div class="nav-icon">💬</div>
                <div>Chat</div>
            </div>
            <div class="nav-item" onclick="showTab('journal')">
                <div class="nav-icon">📖</div>
                <div>Journal</div>
            </div>
            <div class="nav-item" onclick="showTab('tasks')">
                <div class="nav-icon">✅</div>
                <div>Tasks</div>
            </div>
            <div class="nav-item" onclick="showTab('contacts')">
                <div class="nav-icon">👥</div>
                <div>Contacts</div>
            </div>
            <div class="nav-item" onclick="showTab('finance')">
                <div class="nav-icon">💰</div>
                <div>Finance</div>
            </div>
            <div class="nav-item" onclick="showTab('grounding')">
                <div class="nav-icon">🏔️</div>
                <div>Grounding</div>
            </div>
            <div class="nav-item" onclick="showTab('crisis')">
                <div class="nav-icon">⚠️</div>
                <div>Crisis</div>
            </div>
            <div class="nav-item" onclick="showTab('sos')">
                <div class="nav-icon">🆘</div>
                <div>SOS</div>
            </div>
        </div>
        
        <div class="content" id="content">
            <!-- Days Gambling-Free Card -->
            <div class="days-card">
                <h2>Days Gambling-Free</h2>
                <div class="days-number" id="daysCount">0</div>
                <div class="days-text">Start your journey today!</div>
                <div class="days-subtext">Every day is a victory</div>
                <button class="reset-button" onclick="resetCounter()">Reset Counter</button>
            </div>
            
            <!-- Today's Goal Card -->
            <div class="card">
                <h2>Today's Goal</h2>
                <p>Stay focused on your recovery journey. Take it one day at a time.</p>
                <button class="button" onclick="setTodaysGoal()">Set Goal</button>
            </div>
            
            <!-- Progress This Week Card -->
            <div class="card">
                <h2>Progress This Week</h2>
                <p>Tasks completed: <span id="tasksCompleted">0</span></p>
                <p>Journal entries: <span id="journalEntries">0</span></p>
                <p>Grounding exercises: <span id="groundingExercises">0</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="weeklyProgress"></div>
                </div>
                <p>Great start! Keep building momentum.</p>
            </div>
            
            <!-- Financial Recovery Card -->
            <div class="finance-card">
                <h2>💰 Financial Recovery</h2>
                <div class="finance-grid">
                    <div class="finance-item">
                        <h3 id="moneySaved">$0.00</h3>
                        <p>Money Saved</p>
                    </div>
                    <div class="finance-item">
                        <h3 id="netSavings">$0.00</h3>
                        <p>Net Savings</p>
                    </div>
                    <div class="finance-item">
                        <h3 id="dailyAvg">$0.00</h3>
                        <p>Daily Avg</p>
                    </div>
                </div>
                <button class="button" onclick="showTab('finance')">View Full Finance Report</button>
            </div>
        </div>
        
        <div class="fab-container">
            <div class="fab crisis" onclick="showTab('crisis')" title="Crisis Support">🆘</div>
            <div class="fab sos" onclick="callEmergency()" title="Emergency SOS">🚨</div>
        </div>
        
        <div style="padding: 24px;">
            <button class="logout-button" onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = '/';
        }
        
        // Set user name
        const userName = localStorage.getItem('userName') || 'Friend';
        document.getElementById('userName').textContent = userName;
        
        // Load saved data
        loadDashboardData();
        
        function loadDashboardData() {
            // Load days gambling-free
            const daysCount = localStorage.getItem('daysGamblingFree') || '0';
            document.getElementById('daysCount').textContent = daysCount;
            
            // Load tasks completed
            const tasksCompleted = localStorage.getItem('tasksCompleted') || '0';
            document.getElementById('tasksCompleted').textContent = tasksCompleted;
            
            // Load journal entries
            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]').length;
            document.getElementById('journalEntries').textContent = journalEntries;
            
            // Load grounding exercises
            const groundingExercises = localStorage.getItem('groundingExercises') || '0';
            document.getElementById('groundingExercises').textContent = groundingExercises;
            
            // Load financial data
            const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
            const expenseItems = expenses.filter(item => item.type === 'expense');
            const savingsItems = expenses.filter(item => item.type === 'savings');
            
            const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
            const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
            const netAmount = totalSavings - totalExpenses;
            
            document.getElementById('moneySaved').textContent = '$' + totalSavings.toFixed(2);
            document.getElementById('netSavings').textContent = '$' + netAmount.toFixed(2);
            document.getElementById('dailyAvg').textContent = '$' + (totalSavings / 7).toFixed(2);
            
            // Update weekly progress
            const weeklyProgress = Math.min((parseInt(tasksCompleted) + journalEntries + parseInt(groundingExercises)) / 21 * 100, 100);
            document.getElementById('weeklyProgress').style.width = weeklyProgress + '%';
        }
        
        function showTab(tab) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            event.target.closest('.nav-item').classList.add('active');
            
            // Update content based on tab
            const content = document.getElementById('content');
            switch(tab) {
                case 'dashboard':
                    content.innerHTML = `
                        <div class="days-card">
                            <h2>Days Gambling-Free</h2>
                            <div class="days-number" id="daysCount">0</div>
                            <div class="days-text">Start your journey today!</div>
                            <div class="days-subtext">Every day is a victory</div>
                            <button class="reset-button" onclick="resetCounter()">Reset Counter</button>
                        </div>
                        
                        <div class="card">
                            <h2>Today's Goal</h2>
                            <p>Stay focused on your recovery journey. Take it one day at a time.</p>
                            <button class="button" onclick="setTodaysGoal()">Set Goal</button>
                        </div>
                        
                        <div class="card">
                            <h2>Progress This Week</h2>
                            <p>Tasks completed: <span id="tasksCompleted">0</span></p>
                            <p>Journal entries: <span id="journalEntries">0</span></p>
                            <p>Grounding exercises: <span id="groundingExercises">0</span></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="weeklyProgress"></div>
                            </div>
                            <p>Great start! Keep building momentum.</p>
                        </div>
                        
                        <div class="finance-card">
                            <h2>💰 Financial Recovery</h2>
                            <div class="finance-grid">
                                <div class="finance-item">
                                    <h3 id="moneySaved">$0.00</h3>
                                    <p>Money Saved</p>
                                </div>
                                <div class="finance-item">
                                    <h3 id="netSavings">$0.00</h3>
                                    <p>Net Savings</p>
                                </div>
                                <div class="finance-item">
                                    <h3 id="dailyAvg">$0.00</h3>
                                    <p>Daily Avg</p>
                                </div>
                            </div>
                            <button class="button" onclick="showFinanceReport()">View Full Finance Report</button>
                        </div>
                    `;
                    loadDashboardData();
                    break;
                case 'chat':
                    content.innerHTML = `
                        <div class="card">
                            <h2>AI Chat</h2>
                            <p>Chat with our AI assistant for support and guidance.</p>
                            
                            <div id="chatMessages" style="height: 300px; overflow-y: auto; background: #374151; border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 1px solid #4b5563;">
                                <div class="chat-message ai">
                                    <div class="chat-sender ai">AI:</div>
                                    <div class="chat-content">Hello! I'm here to support you on your recovery journey. How are you feeling today?</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="chatInput" placeholder="Type your message..." style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #4b5563; background: #374151; color: #f9fafb; font-size: 14px;" onkeypress="handleChatKeyPress(event)">
                                <button class="button" onclick="sendMessage()" style="margin: 0;">Send</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'journal':
                    content.innerHTML = `
                        <div class="card">
                            <h2>Journal</h2>
                            <p>Record your thoughts and feelings.</p>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="color: #9ca3af; font-size: 14px; margin-bottom: 8px; display: block;">How are you feeling today?</label>
                                <select id="moodSelect" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #4b5563; background: #374151; color: #f9fafb; font-size: 14px; margin-bottom: 16px;">
                                    <option value="great">😊 Great</option>
                                    <option value="good">🙂 Good</option>
                                    <option value="okay">😐 Okay</option>
                                    <option value="struggling">😔 Struggling</option>
                                    <option value="difficult">😰 Difficult</option>
                                </select>
                            </div>
                            
                            <textarea class="textarea" placeholder="Write about your day, your feelings, or your recovery journey..." rows="6"></textarea>
                            
                            <div style="display: flex; gap: 12px; margin-top: 16px;">
                                <button class="button" onclick="saveJournal()" style="flex: 1;">Save Entry</button>
                                <button class="button" onclick="viewJournalEntries()" style="flex: 1; background: #6b7280;">View Entries</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'tasks':
                    // Load saved tasks
                    const savedTasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
                    
                    let tasksHtml = `
                        <div class="card">
                            <h2>Tasks</h2>
                            <p>Complete daily tasks to build healthy habits.</p>
                            
                            <h3 style="color: #60a5fa; margin: 16px 0 12px 0;">Daily Habits</h3>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task1" onchange="updateTask(1)">
                                <label class="task-label" for="task1">Take a 10-minute walk</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task2" onchange="updateTask(2)">
                                <label class="task-label" for="task2">Practice deep breathing for 5 minutes</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task3" onchange="updateTask(3)">
                                <label class="task-label" for="task3">Call a friend or family member</label>
                            </div>
                            <div class="task-item">
                                <input type="checkbox" class="task-checkbox" id="task4" onchange="updateTask(4)">
                                <label class="task-label" for="task4">Write in your journal</label>
                            </div>
                    `;
                    
                    // Add saved tasks (including goals)
                    if (savedTasks.length > 0) {
                        tasksHtml += `<h3 style="color: #34d399; margin: 20px 0 12px 0;">Your Goals & Tasks</h3>`;
                        savedTasks.forEach(task => {
                            const isGoal = task.type === 'goal';
                            const icon = isGoal ? '🎯' : '✅';
                            tasksHtml += `
                                <div class="task-item">
                                    <input type="checkbox" class="task-checkbox" id="savedTask${task.id}" onchange="updateSavedTask(${task.id})">
                                    <label class="task-label" for="savedTask${task.id}">${icon} ${task.text}</label>
                                    <button onclick="deleteTask(${task.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">Delete</button>
                                </div>
                            `;
                        });
                    }
                    
                    tasksHtml += `<button class="button" onclick="addCustomTask()" style="margin-top: 16px;">Add Custom Task</button></div>`;
                    
                    content.innerHTML = tasksHtml;
                    loadTasks();
                    break;
                case 'finance':
                    // Calculate financial data
                    const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                    const expenseItems = expenses.filter(item => item.type === 'expense');
                    const savingsItems = expenses.filter(item => item.type === 'savings');
                    
                    const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
                    const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
                    const netAmount = totalSavings - totalExpenses;
                    
                    const todayExpenses = expenseItems.filter(expense => expense.date === new Date().toLocaleDateString());
                    const todayTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
                    
                    const monthlyGoal = 500;
                    const progress = Math.min((totalSavings / monthlyGoal) * 100, 100);
                    
                    // Determine colors based on whether expenses exceed savings
                    const amountColor = netAmount < 0 ? '#dc2626' : '#60a5fa';
                    const todayColor = todayTotal > 0 ? '#dc2626' : '#60a5fa';
                    
                    content.innerHTML = `
                        <div class="card">
                            <h2>Finance</h2>
                            <p>Track your financial recovery.</p>
                            
                            <div class="progress-grid">
                                <div class="progress-item">
                                    <h3 style="color: ${todayColor}">$${todayTotal.toFixed(2)}</h3>
                                    <p>Spent today</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: ${amountColor}">$${netAmount.toFixed(2)}</h3>
                                    <p>Net amount</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: #34d399">$${totalSavings.toFixed(2)}</h3>
                                    <p>Total saved</p>
                                </div>
                                <div class="progress-item">
                                    <h3 style="color: #60a5fa">${progress.toFixed(0)}%</h3>
                                    <p>Goal progress</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h3 style="color: #60a5fa; margin-bottom: 12px;">Recent Transactions</h3>
                                ${expenses.length > 0 ? expenses.slice(0, 5).map(expense => {
                                    const isExpense = expense.type === 'expense';
                                    const color = isExpense ? '#dc2626' : '#34d399';
                                    const icon = isExpense ? '📉' : '📈';
                                    const prefix = isExpense ? '-' : '+';
                                    return `
                                        <div style="background: #374151; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <span style="color: ${color}; font-weight: 600;">${icon} ${prefix}$${expense.amount.toFixed(2)}</span>
                                                <span style="color: #9ca3af; font-size: 12px; margin-left: 8px;">${expense.date}</span>
                                                <span style="color: #9ca3af; font-size: 12px; margin-left: 4px;">(${expense.type})</span>
                                            </div>
                                            <button onclick="deleteExpense(${expense.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Delete</button>
                                        </div>
                                    `;
                                }).join('') : '<p style="color: #9ca3af;">No transactions yet</p>'}
                            </div>
                            
                            <div style="display: flex; gap: 12px; margin-top: 16px;">
                                <button class="button" onclick="addExpense()" style="flex: 1;">Add Expense</button>
                                <button class="button" onclick="addSavings()" style="flex: 1; background: #34d399;">Add Savings</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'grounding':
                    content.innerHTML = `
                        <div class="card">
                            <h2>🧘 Grounding Exercise</h2>
                            <p>If you're feeling overwhelmed, try this 5-4-3-2-1 technique:</p>
                            
                            <div class="grounding-step">
                                <div class="step-number">5</div>
                                <div class="step-text">things you can see: Look around and name 5 things you can see</div>
                            </div>
                            
                            <div class="grounding-step">
                                <div class="step-number">4</div>
                                <div class="step-text">things you can touch: Name 4 things you can feel with your hands</div>
                            </div>
                            
                            <div class="grounding-step">
                                <div class="step-number">3</div>
                                <div class="step-text">things you can hear: Listen and identify 3 sounds around you</div>
                            </div>
                            
                            <div class="grounding-step">
                                <div class="step-number">2</div>
                                <div class="step-text">things you can smell: Take a deep breath and notice 2 scents</div>
                            </div>
                            
                            <div class="grounding-step">
                                <div class="step-number">1</div>
                                <div class="step-text">thing you can taste: Focus on 1 taste in your mouth</div>
                            </div>
                            
                            <button class="button" onclick="completeGroundingExercise()">Complete Exercise</button>
                        </div>
                    `;
                    break;
                case 'crisis':
                    content.innerHTML = `
                        <div class="crisis-card">
                            <h2>🚨 Crisis Support</h2>
                            <p>You are not alone. Help is available right now.</p>
                            <button class="emergency-button" onclick="callEmergency()">Call Emergency Services (911)</button>
                            <button class="emergency-button" onclick="callSuicidePrevention()" style="background: #60a5fa; border-color: #60a5fa;">Call Suicide Prevention (988)</button>
                            <button class="emergency-button" onclick="textCrisis()" style="background: #34d399; border-color: #34d399;">Text HOME to 741741</button>
                        </div>
                        
                        <div class="card">
                            <h2>🫁 Breathing Exercise</h2>
                            <p>Take a moment to center yourself with guided breathing.</p>
                            
                            <div class="breathing-container">
                                <div class="breathing-circle" id="breathingCircle">
                                    <div class="breathing-text" id="breathingText">Tap to Start</div>
                                </div>
                                <div class="breathing-instructions" id="breathingInstructions">
                                    <p>Follow the circle as it expands and contracts</p>
                                    <p>Breathe in as it grows, breathe out as it shrinks</p>
                                </div>
                                <button class="button" onclick="startBreathingExercise()" id="breathingButton">Start Breathing Exercise</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h2>💙 Remember</h2>
                            <p>• You are not alone in this moment</p>
                            <p>• These feelings are temporary</p>
                            <p>• You are worthy of help and support</p>
                            <p>• There are people who care about you</p>
                            <p>• This crisis will pass</p>
                        </div>
                    `;
                    break;
                case 'sos':
                    content.innerHTML = `
                        <div class="card">
                            <h2>🆘 SOS Support</h2>
                            <p>Emergency contacts and immediate help resources.</p>
                            
                            <div class="contact-card">
                                <h4>🏥 Dr. Sarah Johnson - Therapist</h4>
                                <p>📞 Phone: (555) 123-4567</p>
                                <p>📧 Email: sarah.johnson@therapy.com</p>
                                <button class="contact-button" onclick="callContact('therapist')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>👨‍⚕️ Mike Chen - Counselor</h4>
                                <p>📞 Phone: (555) 987-6543</p>
                                <p>📧 Email: mike.chen@recovery.org</p>
                                <button class="contact-button" onclick="callContact('counselor')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>👨‍👩‍👧‍👦 Mom & Dad</h4>
                                <p>📞 Phone: (555) 456-7890</p>
                                <button class="contact-button" onclick="callContact('family')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>👥 Gamblers Anonymous</h4>
                                <p>📞 Phone: (555) 321-0987</p>
                                <p>📍 Meeting: Tuesdays 7 PM</p>
                                <button class="contact-button" onclick="callContact('support-group')">Call</button>
                            </div>
                        </div>
                    `;
                    break;
                case 'contacts':
                    // Load saved contacts
                    const savedContacts = JSON.parse(localStorage.getItem('contacts') || '[]');
                    
                    let contactsHtml = `
                        <div class="card">
                            <h2>Support Contacts</h2>
                            <p>Your personal support network and professional contacts.</p>
                            
                            <h3 style="color: #60a5fa; margin: 20px 0 12px 0;">Professional Support</h3>
                            <div class="contact-card">
                                <h4>🏥 Dr. Sarah Johnson - Therapist</h4>
                                <p>📞 Phone: (555) 123-4567</p>
                                <p>📧 Email: sarah.johnson@therapy.com</p>
                                <button class="contact-button" onclick="callContact('therapist')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>👨‍⚕️ Mike Chen - Counselor</h4>
                                <p>📞 Phone: (555) 987-6543</p>
                                <p>📧 Email: mike.chen@recovery.org</p>
                                <button class="contact-button" onclick="callContact('counselor')">Call</button>
                            </div>
                            
                            <h3 style="color: #60a5fa; margin: 20px 0 12px 0;">Personal Support</h3>
                            <div class="contact-card">
                                <h4>👨‍👩‍👧‍👦 Mom & Dad</h4>
                                <p>📞 Phone: (555) 456-7890</p>
                                <button class="contact-button" onclick="callContact('family')">Call</button>
                            </div>
                            
                            <div class="contact-card">
                                <h4>👥 Gamblers Anonymous</h4>
                                <p>📞 Phone: (555) 321-0987</p>
                                <p>📍 Meeting: Tuesdays 7 PM</p>
                                <button class="contact-button" onclick="callContact('support-group')">Call</button>
                            </div>
                    `;
                    
                    // Add saved contacts
                    if (savedContacts.length > 0) {
                        contactsHtml += `<h3 style="color: #60a5fa; margin: 20px 0 12px 0;">Your Contacts</h3>`;
                        savedContacts.forEach(contact => {
                            contactsHtml += `
                                <div class="contact-card">
                                    <h4>👤 ${contact.name}</h4>
                                    <p>📞 Phone: ${contact.phone}</p>
                                    <button class="contact-button" onclick="callSavedContact('${contact.name}', '${contact.phone}')">Call</button>
                                    <button class="contact-button" onclick="deleteContact(${contact.id})" style="background: #dc2626; margin-left: 8px;">Delete</button>
                                </div>
                            `;
                        });
                    }
                    
                    contactsHtml += `<button class="button" onclick="addContact()">Add New Contact</button></div>`;
                    
                    content.innerHTML = contactsHtml;
                    break;
            }
        }
        
        function resetCounter() {
            if (confirm('Are you sure you want to reset your gambling-free counter?')) {
                localStorage.setItem('daysGamblingFree', '0');
                document.getElementById('daysCount').textContent = '0';
                alert('Counter reset. You can start fresh!');
            }
        }
        
        function setTodaysGoal() {
            const goal = prompt('What is your goal for today?');
            if (goal) {
                localStorage.setItem('todaysGoal', goal);
                
                // Add the goal as a task
                const newTask = {
                    id: Date.now(),
                    text: goal,
                    completed: false,
                    type: 'goal',
                    date: new Date().toLocaleDateString()
                };
                
                let tasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
                tasks.unshift(newTask);
                localStorage.setItem('savedTasks', JSON.stringify(tasks));
                
                alert('Goal set and added to your tasks! You can do this!');
            }
        }
        
        function updateTask(taskNumber) {
            const tasksCompleted = parseInt(localStorage.getItem('tasksCompleted') || '0');
            localStorage.setItem('tasksCompleted', (tasksCompleted + 1).toString());
            loadDashboardData();
        }
        
        function loadTasks() {
            // Load saved task states
            const savedTasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
            savedTasks.forEach(task => {
                const checkbox = document.getElementById(`task${task.id}`);
                if (checkbox) {
                    checkbox.checked = task.completed;
                }
            });
        }
        
        function showFinanceReport() {
            // Switch to finance tab directly
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to finance nav item
            const financeNavItem = document.querySelector('.nav-item[onclick*="finance"]');
            if (financeNavItem) {
                financeNavItem.classList.add('active');
            }
            
            // Update content directly to finance tab
            const content = document.getElementById('content');
            
            // Calculate financial data
            const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
            const expenseItems = expenses.filter(item => item.type === 'expense');
            const savingsItems = expenses.filter(item => item.type === 'savings');
            
            const totalExpenses = expenseItems.reduce((sum, expense) => sum + expense.amount, 0);
            const totalSavings = savingsItems.reduce((sum, saving) => sum + saving.amount, 0);
            const netAmount = totalSavings - totalExpenses;
            
            const todayExpenses = expenseItems.filter(expense => expense.date === new Date().toLocaleDateString());
            const todayTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            const monthlyGoal = 500;
            const progress = Math.min((totalSavings / monthlyGoal) * 100, 100);
            
            // Determine colors based on whether expenses exceed savings
            const amountColor = netAmount < 0 ? '#dc2626' : '#60a5fa';
            const todayColor = todayTotal > 0 ? '#dc2626' : '#60a5fa';
            
            content.innerHTML = `
                <div class="card">
                    <h2>Finance</h2>
                    <p>Track your financial recovery.</p>
                    
                    <div class="progress-grid">
                        <div class="progress-item">
                            <h3 style="color: ${todayColor}">$${todayTotal.toFixed(2)}</h3>
                            <p>Spent today</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: ${amountColor}">$${netAmount.toFixed(2)}</h3>
                            <p>Net amount</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: #34d399">$${totalSavings.toFixed(2)}</h3>
                            <p>Total saved</p>
                        </div>
                        <div class="progress-item">
                            <h3 style="color: #60a5fa">${progress.toFixed(0)}%</h3>
                            <p>Goal progress</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="color: #60a5fa; margin-bottom: 12px;">Recent Transactions</h3>
                        ${expenses.length > 0 ? expenses.slice(0, 5).map(expense => {
                            const isExpense = expense.type === 'expense';
                            const color = isExpense ? '#dc2626' : '#34d399';
                            const icon = isExpense ? '📉' : '📈';
                            const prefix = isExpense ? '-' : '+';
                            return `
                                <div style="background: #374151; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="color: ${color}; font-weight: 600;">${icon} ${prefix}$${expense.amount.toFixed(2)}</span>
                                        <span style="color: #9ca3af; font-size: 12px; margin-left: 8px;">${expense.date}</span>
                                        <span style="color: #9ca3af; font-size: 12px; margin-left: 4px;">(${expense.type})</span>
                                    </div>
                                    <button onclick="deleteExpense(${expense.id})" style="background: #dc2626; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Delete</button>
                                </div>
                            `;
                        }).join('') : '<p style="color: #9ca3af;">No transactions yet</p>'}
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button class="button" onclick="addExpense()" style="flex: 1;">Add Expense</button>
                        <button class="button" onclick="addSavings()" style="flex: 1; background: #34d399;">Add Savings</button>
                    </div>
                </div>
            `;
        }
        
        function updateSavedTask(taskId) {
            const checkbox = document.getElementById(`savedTask${taskId}`);
            const tasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                task.completed = checkbox.checked;
                localStorage.setItem('savedTasks', JSON.stringify(tasks));
                
                if (checkbox.checked) {
                    const tasksCompleted = parseInt(localStorage.getItem('tasksCompleted') || '0');
                    localStorage.setItem('tasksCompleted', (tasksCompleted + 1).toString());
                    loadDashboardData();
                }
            }
        }
        
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                let tasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
                tasks = tasks.filter(task => task.id !== taskId);
                localStorage.setItem('savedTasks', JSON.stringify(tasks));
                showTab('tasks'); // Refresh the tasks view
            }
        }
        
        function addCustomTask() {
            const taskText = prompt('Enter your custom task:');
            if (taskText) {
                const newTask = {
                    id: Date.now(),
                    text: taskText,
                    completed: false,
                    type: 'custom',
                    date: new Date().toLocaleDateString()
                };
                
                let tasks = JSON.parse(localStorage.getItem('savedTasks') || '[]');
                tasks.unshift(newTask);
                localStorage.setItem('savedTasks', JSON.stringify(tasks));
                
                alert('Custom task added!');
                showTab('tasks'); // Refresh the tasks view
            }
        }
        
        function completeGroundingExercise() {
            const groundingExercises = parseInt(localStorage.getItem('groundingExercises') || '0');
            localStorage.setItem('groundingExercises', (groundingExercises + 1).toString());
            alert('Great job! You completed the grounding exercise. Take a moment to notice how you feel.');
            loadDashboardData();
        }
        
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            localStorage.removeItem('userPassword');
            alert('Logged out successfully!');
            window.location.href = '/';
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) {
                return;
            }
            
            // Add user message to chat
            addMessageToChat('You', message, '#60a5fa');
            input.value = '';
            
            // Simulate AI response based on user input
            setTimeout(() => {
                let response = "";
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('step') || lowerMessage.includes('plan') || lowerMessage.includes('help')) {
                    response = "Here's a step-by-step plan to help you stop gambling:\n\n1. **Acknowledge the problem** - You've already done this by reaching out!\n2. **Set a quit date** - Choose a specific date to stop completely\n3. **Remove triggers** - Delete gambling apps, block gambling sites\n4. **Find alternatives** - Replace gambling with healthy activities\n5. **Build support** - Connect with friends, family, or support groups\n6. **Track progress** - Use this app to monitor your recovery\n7. **Celebrate milestones** - Reward yourself for each day gambling-free\n\nWould you like me to help you with any specific step?";
                } else if (lowerMessage.includes('urge') || lowerMessage.includes('craving') || lowerMessage.includes('want to gamble')) {
                    response = "When you feel the urge to gamble, try these techniques:\n\n🚨 **Immediate actions:**\n• Take 10 deep breaths\n• Call a support person\n• Go for a walk\n• Do something with your hands\n\n💪 **Long-term strategies:**\n• Identify your triggers\n• Practice mindfulness\n• Keep busy with hobbies\n• Remember why you're quitting\n\nYou've got this! The urge will pass.";
                } else if (lowerMessage.includes('relapse') || lowerMessage.includes('slipped') || lowerMessage.includes('gambled')) {
                    response = "It's okay - relapses are part of recovery. Don't be too hard on yourself.\n\n**What to do now:**\n1. Stop immediately - don't chase losses\n2. Remove yourself from the situation\n3. Call someone for support\n4. Learn from this experience\n5. Get back on track\n\n**Remember:** Every day is a new chance to start fresh. You're still making progress!";
                } else if (lowerMessage.includes('money') || lowerMessage.includes('debt') || lowerMessage.includes('financial')) {
                    response = "Financial recovery is important. Here are some steps:\n\n💰 **Immediate actions:**\n• Stop all gambling immediately\n• Create a budget\n• Cut unnecessary expenses\n• Consider debt consolidation\n\n📊 **Track your progress:**\n• Use the Finance tab in this app\n• Monitor money saved daily\n• Set realistic financial goals\n\n💡 **Remember:** Every dollar not gambled is money saved!";
                } else if (lowerMessage.includes('family') || lowerMessage.includes('relationship') || lowerMessage.includes('support')) {
                    response = "Building a support system is crucial for recovery:\n\n👨‍👩‍👧‍👦 **Family & Friends:**\n• Be honest about your struggles\n• Ask for their support\n• Let them know how they can help\n• Consider family therapy\n\n🤝 **Professional Support:**\n• Therapists specializing in gambling addiction\n• Support groups (Gamblers Anonymous)\n• Financial counselors\n• This AI assistant (me!)\n\nYou don't have to do this alone!";
                } else {
                    const responses = [
                        "I'm here to support you on your recovery journey. What specific challenge are you facing today?",
                        "It's great that you're reaching out for help. How can I best support you right now?",
                        "I understand this is difficult. What would be most helpful for you to hear right now?",
                        "You're taking important steps by seeking support. What's on your mind?",
                        "I'm proud of you for reaching out. What's been the most challenging part of your day?",
                        "Remember, recovery is a journey with ups and downs. How are you feeling right now?",
                        "You're stronger than you think. What support do you need today?",
                        "Every small step counts in recovery. What would help you feel more supported?"
                    ];
                    response = responses[Math.floor(Math.random() * responses.length)];
                }
                
                addMessageToChat('AI', response, '#34d399');
            }, 1000);
        }
        
        function addMessageToChat(sender, message, color) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender.toLowerCase()}`;
            
            const senderDiv = document.createElement('div');
            senderDiv.className = `chat-sender ${sender.toLowerCase()}`;
            senderDiv.textContent = sender + ':';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-content';
            contentDiv.textContent = message;
            
            messageDiv.appendChild(senderDiv);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function saveJournal() {
            const textarea = document.querySelector('.textarea');
            const moodSelect = document.getElementById('moodSelect');
            const entry = textarea.value.trim();
            const mood = moodSelect ? moodSelect.value : 'okay';
            
            if (!entry) {
                alert('Please write something before saving.');
                return;
            }
            
            // Save to localStorage for demo
            const journalEntry = {
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                mood: mood,
                content: entry
            };
            
            let entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            entries.unshift(journalEntry);
            localStorage.setItem('journalEntries', JSON.stringify(entries));
            
            alert('Journal entry saved successfully! Keep reflecting on your journey.');
            textarea.value = '';
            loadDashboardData();
        }
        
        function viewJournalEntries() {
            const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
            
            if (entries.length === 0) {
                alert('No journal entries yet. Start writing to track your journey!');
                return;
            }
            
            let entriesHtml = '<div class="card"><h2>Your Journal Entries</h2>';
            entries.forEach((entry, index) => {
                const moodEmoji = {
                    'great': '😊',
                    'good': '🙂',
                    'okay': '😐',
                    'struggling': '😔',
                    'difficult': '😰'
                }[entry.mood] || '😐';
                
                entriesHtml += `
                    <div style="background: #374151; padding: 16px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #4b5563;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: #60a5fa; font-weight: 600;">${moodEmoji} ${entry.mood.charAt(0).toUpperCase() + entry.mood.slice(1)}</span>
                            <span style="color: #9ca3af; font-size: 12px;">${entry.date} ${entry.time}</span>
                        </div>
                        <p style="color: #f9fafb; margin: 0; line-height: 1.5;">${entry.content}</p>
                    </div>
                `;
            });
            entriesHtml += '</div>';
            
            document.getElementById('content').innerHTML = entriesHtml;
        }
        
        function addExpense() {
            const amount = prompt('Enter expense amount:');
            if (amount && !isNaN(amount)) {
                // Save expense to localStorage
                const expense = {
                    id: Date.now(),
                    amount: parseFloat(amount),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    type: 'expense'
                };
                
                let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                expenses.unshift(expense);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                
                alert(`Expense of $${amount} added successfully!`);
                loadDashboardData();
            } else {
                alert('Please enter a valid amount.');
            }
        }
        
        function addSavings() {
            const amount = prompt('Enter savings amount:');
            if (amount && !isNaN(amount)) {
                // Save savings to localStorage
                const saving = {
                    id: Date.now(),
                    amount: parseFloat(amount),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    type: 'savings'
                };
                
                let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                expenses.unshift(saving);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                
                alert(`Savings of $${amount} added successfully!`);
                loadDashboardData();
            } else {
                alert('Please enter a valid amount.');
            }
        }
        
        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                expenses = expenses.filter(expense => expense.id !== expenseId);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                alert('Expense deleted successfully!');
                showTab('finance');
            }
        }
        
        function callEmergency() {
            if (confirm('Are you sure you want to call emergency services? This will dial 911.')) {
                alert('Emergency services will be contacted. Please stay safe.');
            }
        }
        
        function callSuicidePrevention() {
            if (confirm('Call Suicide Prevention Lifeline (988)?')) {
                alert('Connecting to Suicide Prevention Lifeline...');
            }
        }
        
        function textCrisis() {
            if (confirm('Text HOME to 741741 for crisis support?')) {
                alert('Opening text message to crisis support...');
            }
        }
        
        function startBreathingExercise() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const button = document.getElementById('breathingButton');
            const instructions = document.getElementById('breathingInstructions');
            
            if (button.textContent === 'Start Breathing Exercise') {
                button.textContent = 'Stop Exercise';
                instructions.innerHTML = '<p>Breathe in as the circle expands</p><p>Breathe out as the circle contracts</p>';
                
                let cycleCount = 0;
                const maxCycles = 5;
                let isRunning = true;
                
                // Start the breathing cycle
                function breathingCycle() {
                    if (!isRunning || cycleCount >= maxCycles) {
                        if (cycleCount >= maxCycles) {
                            circle.className = 'breathing-circle';
                            text.textContent = 'Exercise Complete!';
                            button.textContent = 'Start Breathing Exercise';
                            instructions.innerHTML = '<p>Great job! You\'ve completed the breathing exercise.</p><p>Take a moment to notice how you feel.</p>';
                        }
                        return;
                    }
                    
                    // Breathe in phase
                    circle.className = 'breathing-circle breathing-in';
                    text.textContent = 'Breathe In';
                    
                    setTimeout(() => {
                        if (!isRunning) return;
                        
                        // Breathe out phase
                        circle.className = 'breathing-circle breathing-out';
                        text.textContent = 'Breathe Out';
                        
                        setTimeout(() => {
                            if (!isRunning) return;
                            
                            cycleCount++;
                            if (cycleCount < maxCycles) {
                                // Brief pause between cycles
                                circle.className = 'breathing-circle';
                                text.textContent = 'Pause';
                                
                                setTimeout(() => {
                                    if (isRunning) {
                                        breathingCycle();
                                    }
                                }, 1000);
                            } else {
                                // Exercise complete
                                circle.className = 'breathing-circle';
                                text.textContent = 'Exercise Complete!';
                                button.textContent = 'Start Breathing Exercise';
                                instructions.innerHTML = '<p>Great job! You\'ve completed the breathing exercise.</p><p>Take a moment to notice how you feel.</p>';
                            }
                        }, 4000); // 4 seconds for breathing out
                    }, 4000); // 4 seconds for breathing in
                }
                
                // Store running state for stopping
                circle.dataset.isRunning = 'true';
                breathingCycle();
                
            } else {
                // Stop the exercise
                circle.dataset.isRunning = 'false';
                circle.className = 'breathing-circle';
                text.textContent = 'Tap to Start';
                button.textContent = 'Start Breathing Exercise';
                instructions.innerHTML = '<p>Follow the circle as it expands and contracts</p><p>Breathe in as it grows, breathe out as it shrinks</p>';
            }
        }
        
        function callContact(contactType) {
            const contacts = {
                'therapist': 'Dr. Sarah Johnson',
                'counselor': 'Mike Chen',
                'family': 'Mom & Dad',
                'support-group': 'Gamblers Anonymous'
            };
            
            const contactName = contacts[contactType];
            if (confirm(`Call ${contactName}?`)) {
                alert(`Calling ${contactName}... Stay strong!`);
            }
        }
        
        function addContact() {
            const name = prompt('Enter contact name:');
            if (name) {
                const phone = prompt('Enter phone number:');
                if (phone) {
                    // Save contact to localStorage
                    const contact = {
                        id: Date.now(),
                        name: name,
                        phone: phone,
                        type: 'personal'
                    };
                    
                    let contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
                    contacts.push(contact);
                    localStorage.setItem('contacts', JSON.stringify(contacts));
                    
                    alert(`Contact "${name}" with phone "${phone}" added successfully!`);
                    // Refresh contacts view
                    showTab('contacts');
                } else {
                    alert('Contact not added - phone number required.');
                }
            } else {
                alert('Contact not added - name required.');
            }
        }
        
        function callSavedContact(name, phone) {
            if (confirm(`Call ${name} at ${phone}?`)) {
                alert(`Calling ${name}... Stay strong!`);
            }
        }
        
        function deleteContact(contactId) {
            if (confirm('Are you sure you want to delete this contact?')) {
                let contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
                contacts = contacts.filter(contact => contact.id !== contactId);
                localStorage.setItem('contacts', JSON.stringify(contacts));
                alert('Contact deleted successfully!');
                showTab('contacts');
            }
        }
    </script>
</body>
</html>